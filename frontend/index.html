<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="/static/styles.css?v=17" rel="stylesheet">
    <link href="/static/responsive-styles.css?v=1" rel="stylesheet">
    <link href="/static/css/health-status.css?v=1" rel="stylesheet">
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIj4KICA8IS0tIEJhY2tncm91bmQgZ3JhZGllbnQgLS0+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImJnR3JhZGllbnQiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdHlsZT0ic3RvcC1jb2xvcjojNjY3ZWVhO3N0b3Atb3BhY2l0eToxIiAvPgogICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiM3NjRiYTI7c3RvcC1vcGFjaXR5OjEiIC8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogICAgPCEtLSBTaGFkb3cgZmlsdGVyIC0tPgogICAgPGZpbHRlciBpZD0ic2hhZG93IiB4PSItNTAlIiB5PSItNTAlIiB3aWR0aD0iMjAwJSIgaGVpZ2h0PSIyMDAlIj4KICAgICAgPGZlRHJvcFNoYWRvdyBkeD0iMCIgZHk9IjEiIHN0ZERldmlhdGlvbj0iMSIgZmxvb2Qtb3BhY2l0eT0iMC4yIi8+CiAgICA8L2ZpbHRlcj4KICA8L2RlZnM+CiAgCiAgPCEtLSBCYWNrZ3JvdW5kIGNpcmNsZSAtLT4KICA8Y2lyY2xlIGN4PSIxNiIgY3k9IjE2IiByPSIxNSIgZmlsbD0idXJsKCNiZ0dyYWRpZW50KSIvPgogIAogIDwhLS0gRG9jdW1lbnQgaWNvbiAtLT4KICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNiwgMTYpIj4KICAgIDwhLS0gTWFpbiBkb2N1bWVudCAtLT4KICAgIDxwYXRoIGQ9Ik0gLTYgLTkgTCAtNiA3IFEgLTYgOSAtNCA5IEwgNCA5IFEgNiA5IDYgNyBMIDYgLTMgTCAwIC05IFoiIAogICAgICAgICAgZmlsbD0id2hpdGUiIAogICAgICAgICAgZmlsdGVyPSJ1cmwoI3NoYWRvdykiLz4KICAgIAogICAgPCEtLSBGb2xkZXIgY29ybmVyIC0tPgogICAgPHBhdGggZD0iTSAwIC05IEwgMCAtMyBMIDYgLTMgWiIgCiAgICAgICAgICBmaWxsPSJyZ2JhKDI1NSwyNTUsMjU1LDAuNykiLz4KICAgIAogICAgPCEtLSBEb2N1bWVudCBsaW5lcyAtLT4KICAgIDxyZWN0IHg9Ii0zIiB5PSItMSIgd2lkdGg9IjYiIGhlaWdodD0iMS41IiByeD0iMC41IiBmaWxsPSIjNjY3ZWVhIiBvcGFjaXR5PSIwLjUiLz4KICAgIDxyZWN0IHg9Ii0zIiB5PSIyIiB3aWR0aD0iNCIgaGVpZ2h0PSIxLjUiIHJ4PSIwLjUiIGZpbGw9IiM2NjdlZWEiIG9wYWNpdHk9IjAuNSIvPgogICAgPHJlY3QgeD0iLTMiIHk9IjUiIHdpZHRoPSI1IiBoZWlnaHQ9IjEuNSIgcng9IjAuNSIgZmlsbD0iIzY2N2VlYSIgb3BhY2l0eT0iMC41Ii8+CiAgPC9nPgo8L3N2Zz4=">
    <style>
        /* Mobile overlay for modals */
        .mobile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1019;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .mobile-overlay.show {
            display: block;
            opacity: 1;
        }

        /* Touch active state */
        .touch-active {
            transform: scale(0.98);
            opacity: 0.8;
        }

        /* Relations list styling */
        #relationsContent .list-group-item {
            overflow: hidden;
        }

        #relationsContent .list-group-item strong {
            display: block;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 100%;
        }

        #relationsContent .list-group-item .text-muted {
            display: block;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container-fluid px-5">
            <a class="navbar-brand gradient-text me-4" href="#" onclick="showTab('documents')">
                <i class="fas fa-file-contract me-2"></i>DocuManager
            </a>
            <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <i class="fas fa-bars text-light"></i>
            </button>
            <!-- Mobile Search Button -->
            <button class="btn btn-link text-light mobile-only ms-auto me-2" onclick="toggleMobileSearch()"
                style="font-size: 1.2rem;">
                <i class="fas fa-search"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto ms-2">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" onclick="showTab('documents')">
                            <i class="fas fa-folder-open me-1"></i><span class="nav-text">Documents</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showTab('search')">
                            <i class="fas fa-magnifying-glass me-1"></i><span class="nav-text">Search</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showTab('upload')">
                            <i class="fas fa-cloud-arrow-up me-1"></i><span class="nav-text">Upload</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showTab('rag')">
                            <i class="fas fa-robot me-1"></i><span class="nav-text">Ask AI</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showTab('manage')">
                            <i class="fas fa-sliders me-1"></i><span class="nav-text">Manage</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showTab('about')">
                            <i class="fas fa-info-circle me-1"></i><span class="nav-text">About</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showTab('settings')">
                            <i class="fas fa-gear me-1"></i><span class="nav-text">Settings</span>
                        </a>
                    </li>
                </ul>

                <!-- Quick Search Bar -->
                <div class="navbar-nav ms-auto me-3">
                    <div class="nav-item">
                        <div class="input-group input-group-sm navbar-search-group">
                            <input type="text" id="navbar-search" class="form-control" placeholder="Quick search..."
                                onkeypress="handleNavbarSearchKeyPress(event)">
                            <button class="btn btn-outline-light" onclick="performNavbarSearch()">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Logout Button -->
                <div class="navbar-nav">
                    <div class="nav-item">
                        <button class="btn btn-outline-light" onclick="logout()" title="Abmelden">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </nav>

    <div class="container-fluid main-content">
        <!-- Mobile Search Modal -->
        <div class="mobile-search-modal" id="mobile-search-modal">
            <div class="input-group">
                <input type="text" class="form-control" placeholder="Search documents..." id="mobile-search-input">
                <button class="btn btn-primary" onclick="performMobileSearch()">
                    <i class="fas fa-search"></i>
                </button>
                <button class="btn btn-secondary" onclick="closeMobileSearch()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <!-- Mobile Filter Toggle Button -->
        <button class="btn btn-primary mobile-only mb-3" onclick="toggleMobileFilters()"
            style="position: fixed; bottom: 20px; right: 20px; z-index: 1000; border-radius: 50%; width: 56px; height: 56px;">
            <i class="fas fa-filter"></i>
        </button>

        <!-- Documents Tab -->
        <div id="documents-tab" class="tab-content fade-in">
            <div class="row">
                <div class="col-lg-3 col-md-4 mb-4">
                    <div class="filter-sidebar" id="filter-sidebar">
                        <div class="card-header">
                            <div class="filter-label">
                                <i class="fas fa-filter"></i>
                                <span>Filters</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="filter-group">
                                <label class="filter-label">
                                    <i class="fas fa-user"></i>Correspondent
                                </label>
                                <div class="correspondent-multiselect">
                                    <div class="selected-correspondent" id="selected-correspondent-display"
                                        onclick="toggleCorrespondentDropdown()">
                                        <span class="placeholder">All Correspondents</span>
                                        <i class="fas fa-chevron-down ms-auto"></i>
                                    </div>
                                    <div class="correspondent-dropdown d-none" id="correspondent-dropdown">
                                        <div class="correspondent-dropdown-content">
                                            <!-- Correspondents will be populated here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">
                                    <i class="fas fa-file-alt"></i>Document Type
                                </label>
                                <div class="doctype-multiselect">
                                    <div class="selected-doctype" id="selected-doctype-display"
                                        onclick="toggleDoctypeDropdown()">
                                        <span class="placeholder">All Types</span>
                                        <i class="fas fa-chevron-down ms-auto"></i>
                                    </div>
                                    <div class="doctype-dropdown d-none" id="doctype-dropdown">
                                        <div class="doctype-dropdown-content">
                                            <!-- Document types will be populated here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">
                                    <i class="fas fa-tags"></i>Tags
                                </label>
                                <div class="tags-multiselect">
                                    <div class="selected-tags" id="selected-tags-display"
                                        onclick="toggleTagsDropdown()">
                                        <span class="placeholder">All Tags</span>
                                        <i class="fas fa-chevron-down ms-auto"></i>
                                    </div>
                                    <div class="tags-dropdown d-none" id="tags-dropdown">
                                        <div class="tags-dropdown-content">
                                            <!-- Tags will be populated here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">
                                    <i class="fas fa-calendar-alt"></i>Document Date
                                </label>
                                <div class="date-multiselect">
                                    <div class="selected-date" id="selected-date-display"
                                        onclick="toggleDateDropdown()">
                                        <span class="placeholder">Zeitraum auswählen...</span>
                                        <i class="fas fa-chevron-down ms-auto"></i>
                                    </div>
                                    <div class="date-dropdown d-none" id="date-dropdown">
                                        <div class="date-dropdown-content">
                                            <div class="date-option" onclick="selectDatePreset('')">Alle Dokumente</div>
                                            <div class="date-option" onclick="selectDatePreset('today')">Heute</div>
                                            <div class="date-option" onclick="selectDatePreset('yesterday')">Gestern</div>
                                            <div class="date-option" onclick="selectDatePreset('last_7_days')">Letzte 7 Tage</div>
                                            <div class="date-option" onclick="selectDatePreset('last_30_days')">Letzte 30 Tage</div>
                                            <div class="date-option" onclick="selectDatePreset('this_week')">Diese Woche</div>
                                            <div class="date-option" onclick="selectDatePreset('last_week')">Letzte Woche</div>
                                            <div class="date-option" onclick="selectDatePreset('this_month')">Dieser Monat</div>
                                            <div class="date-option" onclick="selectDatePreset('last_month')">Letzter Monat</div>
                                            <div class="date-option" onclick="selectDatePreset('this_year')">Dieses Jahr</div>
                                            <div class="date-option" onclick="selectDatePreset('last_year')">Letztes Jahr</div>
                                            <div class="date-option" onclick="selectDatePreset('custom')">Benutzerdefiniert...</div>
                                        </div>
                                    </div>
                                    <!-- Hidden input for backward compatibility -->
                                    <input type="hidden" id="filter-date-preset" value="">
                                </div>
                                <div class="custom-date-inputs d-none" id="custom-date-inputs">
                                    <div class="row g-2">
                                        <div class="col-6">
                                            <input type="date" class="form-control form-control-sm"
                                                id="filter-date-from" onchange="applyFilters()" placeholder="From">
                                            <small class="form-text text-muted">From</small>
                                        </div>
                                        <div class="col-6">
                                            <input type="date" class="form-control form-control-sm" id="filter-date-to"
                                                onchange="applyFilters()" placeholder="To">
                                            <small class="form-text text-muted">To</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="filter-group">
                                <label for="filter-reminder" class="filter-label">
                                    <i class="fas fa-bell"></i>Reminders
                                </label>
                                <div class="reminder-multiselect">
                                    <div class="selected-reminder" id="selected-reminder-display"
                                        onclick="toggleReminderDropdown()">
                                        <span class="placeholder">Alle Dokumente</span>
                                        <i class="fas fa-chevron-down ms-auto"></i>
                                    </div>
                                    <div class="reminder-dropdown d-none" id="reminder-dropdown">
                                        <div class="reminder-dropdown-content">
                                            <!-- Reminder options will be populated here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="filter-group">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="filter-tax-relevant"
                                        onchange="applyFilters()">
                                    <label class="form-check-label" for="filter-tax-relevant">
                                        <i class="fas fa-receipt"></i>Tax Relevant Only
                                    </label>
                                </div>
                            </div>
                            <div class="filter-actions">
                                <button class="btn btn-outline-secondary w-100" onclick="clearFilters()">
                                    <i class="fas fa-times me-2"></i>Reset Filters
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-9 col-md-8 col-12">
                    <div class="documents-section">
                        <div class="documents-header">
                            <div class="documents-title">
                                <i class="fas fa-folder-open text-primary"></i>
                                <h6>Documents</h6>
                                <span id="document-count" class="documents-count">0</span>
                            </div>
                            <div class="documents-controls">
                                <div class="view-toggle">
                                    <button class="btn active" onclick="toggleView('grid')">
                                        <i class="fas fa-th"></i>
                                    </button>
                                    <button class="btn" onclick="toggleView('list')">
                                        <i class="fas fa-list"></i>
                                    </button>
                                </div>
                                <button class="btn btn-primary btn-sm hover-glow" onclick="refreshDocuments()">
                                    <i class="fas fa-arrows-rotate me-1"></i>Refresh
                                </button>
                                <button id="retry-all-failed-btn" class="btn btn-warning btn-sm hover-glow ms-2 d-none" onclick="retryAllFailed()" title="Retry all failed documents">
                                    <i class="fas fa-redo me-1"></i>Retry All Failed
                                </button>
                            </div>
                        </div>
                        <div class="documents-body">
                            <div id="documents-loading" class="text-center py-5 d-none">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="mt-3 text-secondary">Loading documents...</p>
                            </div>
                            <div id="documents-list" class="document-grid">
                                <!-- Documents will be populated here -->
                            </div>
                            <nav>
                                <ul id="documents-pagination" class="pagination justify-content-center mt-4">
                                    <!-- Pagination will be populated here -->
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Search Tab -->
        <div id="search-tab" class="tab-content d-none fade-in">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="card glass-effect hover-lift">
                        <div class="card-header text-center">
                            <i class="fas fa-magnifying-glass me-2 text-primary"></i>
                            <h5 class="mb-0">Document Search</h5>
                            <p class="text-secondary mb-0 mt-1">Find documents using advanced search capabilities</p>
                        </div>
                        <div class="card-body">
                            <div class="mb-4">
                                <div class="input-group">
                                    <input type="text" id="search-query" class="form-control form-control-lg"
                                        placeholder="Search documents..." onkeypress="handleSearchKeyPress(event)">
                                    <button class="btn btn-primary" onclick="performSearch()">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                                <div class="form-check mt-2">
                                    <input class="form-check-input" type="checkbox" id="search-semantic" checked>
                                    <label class="form-check-label" for="search-semantic">
                                        Use semantic search (AI-powered)
                                    </label>
                                </div>
                            </div>

                            <!-- Search Filters -->
                            <div class="border-top pt-3 mb-3">
                                <h6 class="mb-3">Filters</h6>
                                <div class="row">
                                    <div class="col-md-4">
                                        <label class="form-label">Correspondent</label>
                                        <div class="search-correspondent-multiselect">
                                            <div class="selected-search-correspondent"
                                                id="selected-search-correspondent-display"
                                                onclick="toggleSearchCorrespondentDropdown()">
                                                <span class="placeholder">All Correspondents</span>
                                                <i class="fas fa-chevron-down ms-auto"></i>
                                            </div>
                                            <div class="search-correspondent-dropdown d-none"
                                                id="search-correspondent-dropdown">
                                                <div class="search-correspondent-dropdown-content">
                                                    <!-- Correspondents will be populated here -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">Document Type</label>
                                        <div class="search-doctype-multiselect">
                                            <div class="selected-search-doctype" id="selected-search-doctype-display"
                                                onclick="toggleSearchDoctypeDropdown()">
                                                <span class="placeholder">All Types</span>
                                                <i class="fas fa-chevron-down ms-auto"></i>
                                            </div>
                                            <div class="search-doctype-dropdown d-none" id="search-doctype-dropdown">
                                                <div class="search-doctype-dropdown-content">
                                                    <!-- Document types will be populated here -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="search-filter-tag" class="form-label">Tags</label>
                                        <div class="tags-multiselect">
                                            <div class="selected-tags" id="search-selected-tags-display"
                                                onclick="toggleSearchTagsDropdown()">
                                                <span class="placeholder">All Tags</span>
                                                <i class="fas fa-chevron-down ms-auto"></i>
                                            </div>
                                            <div class="tags-dropdown d-none" id="search-tags-dropdown">
                                                <div class="tags-dropdown-content">
                                                    <!-- Tags will be populated here -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Advanced Date Range Filter -->
                                <div class="row mt-3">
                                    <div class="col-md-12">
                                        <label class="form-label">
                                            <i class="fas fa-calendar-alt me-1"></i>Document Date Range
                                        </label>
                                        <div class="search-date-multiselect">
                                            <div class="selected-search-date" id="selected-search-date-display"
                                                onclick="toggleSearchDateDropdown()">
                                                <span class="placeholder">Alle Zeiträume</span>
                                                <i class="fas fa-chevron-down ms-auto"></i>
                                            </div>
                                            <div class="search-date-dropdown d-none" id="search-date-dropdown">
                                                <div class="search-date-dropdown-content">
                                                    <div class="search-date-option" onclick="selectSearchDatePreset('')">Alle Zeiträume</div>
                                                    <div class="search-date-option" onclick="selectSearchDatePreset('today')">Heute</div>
                                                    <div class="search-date-option" onclick="selectSearchDatePreset('yesterday')">Gestern</div>
                                                    <div class="search-date-option" onclick="selectSearchDatePreset('last_7_days')">Letzte 7 Tage</div>
                                                    <div class="search-date-option" onclick="selectSearchDatePreset('last_30_days')">Letzte 30 Tage</div>
                                                    <div class="search-date-option" onclick="selectSearchDatePreset('last_90_days')">Letzte 90 Tage</div>
                                                    <div class="search-date-option" onclick="selectSearchDatePreset('this_week')">Diese Woche</div>
                                                    <div class="search-date-option" onclick="selectSearchDatePreset('last_week')">Letzte Woche</div>
                                                    <div class="search-date-option" onclick="selectSearchDatePreset('this_month')">Dieser Monat</div>
                                                    <div class="search-date-option" onclick="selectSearchDatePreset('last_month')">Letzter Monat</div>
                                                    <div class="search-date-option" onclick="selectSearchDatePreset('this_quarter')">Dieses Quartal</div>
                                                    <div class="search-date-option" onclick="selectSearchDatePreset('last_quarter')">Letztes Quartal</div>
                                                    <div class="search-date-option" onclick="selectSearchDatePreset('this_year')">Dieses Jahr</div>
                                                    <div class="search-date-option" onclick="selectSearchDatePreset('last_year')">Letztes Jahr</div>
                                                    <div class="search-date-option" onclick="selectSearchDatePreset('custom')">Benutzerdefiniert...</div>
                                                </div>
                                            </div>
                                            <!-- Hidden input for backward compatibility -->
                                            <input type="hidden" id="search-date-preset" value="">
                                        </div>
                                        <div class="search-custom-dates d-none" id="search-custom-dates">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <input type="date" class="form-control" id="search-date-from"
                                                        onchange="performSearch()" placeholder="Von">
                                                    <small class="text-muted">Von</small>
                                                </div>
                                                <div class="col-md-6">
                                                    <input type="date" class="form-control" id="search-date-to"
                                                        onchange="performSearch()" placeholder="Bis">
                                                    <small class="text-muted">Bis</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Enhanced Reminder Filter -->
                                <div class="row mt-3">
                                    <div class="col-md-12">
                                        <label class="form-label">
                                            <i class="fas fa-bell me-1"></i>Erinnerungs-Status
                                        </label>
                                        <div class="search-reminder-multiselect">
                                            <div class="selected-search-reminder" id="selected-search-reminder-display"
                                                onclick="toggleSearchReminderDropdown()">
                                                <span class="placeholder">Alle Dokumente</span>
                                                <i class="fas fa-chevron-down ms-auto"></i>
                                            </div>
                                            <div class="search-reminder-dropdown d-none" id="search-reminder-dropdown">
                                                <div class="search-reminder-dropdown-content">
                                                    <div class="search-reminder-option" onclick="selectSearchReminderOption('all')">Alle Dokumente</div>
                                                    <div class="search-reminder-option" onclick="selectSearchReminderOption('has')">Mit Erinnerung</div>
                                                    <div class="search-reminder-option" onclick="selectSearchReminderOption('overdue')">Überfällige Erinnerungen</div>
                                                    <div class="search-reminder-option" onclick="selectSearchReminderOption('none')">Ohne Erinnerung</div>
                                                </div>
                                            </div>
                                            <!-- Hidden input for backward compatibility -->
                                            <input type="hidden" id="search-reminder-select" value="all">
                                        </div>
                                    </div>
                                </div>

                                <div class="row mt-3">
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="search-filter-tax"
                                                onchange="performSearch()">
                                            <label class="form-check-label" for="search-filter-tax">
                                                Tax relevant only
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-6 text-end">
                                        <button type="button" class="btn btn-outline-secondary btn-sm"
                                            onclick="clearSearchFilters()">
                                            <i class="fas fa-times me-1"></i>Clear Filters
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div id="search-results" class="d-none">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h6>Search Results</h6>
                                    <button class="btn btn-sm btn-outline-secondary" onclick="saveCurrentSearch()">
                                        <i class="fas fa-bookmark me-1"></i>Save Search
                                    </button>
                                </div>
                                <div id="search-results-list">
                                    <!-- Results will be populated here -->
                                </div>
                            </div>

                            <!-- Saved Searches -->
                            <div id="saved-searches" class="mt-4">
                                <h6>Saved Searches</h6>
                                <div id="saved-searches-list">
                                    <!-- Saved searches will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Upload Tab -->
        <div id="upload-tab" class="tab-content d-none fade-in">
            <div class="row">
                <div class="col-md-6 mx-auto">
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="fas fa-upload me-2"></i>Upload Documents</h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-4">
                                <label for="file-upload" class="form-label">Select files to upload</label>
                                <input type="file" class="form-control" id="file-upload" multiple
                                    accept=".pdf,.png,.jpg,.jpeg,.tiff,.bmp">
                                <div class="form-text">
                                    Supported formats: PDF, PNG, JPG, JPEG, TIFF, BMP
                                </div>
                            </div>
                            <button class="btn btn-primary w-100" onclick="uploadFiles()">
                                <i class="fas fa-upload me-2"></i>Upload Files
                            </button>
                            <div id="upload-progress" class="mt-3 d-none">
                                <div class="progress">
                                    <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                                </div>
                                <div id="upload-status" class="mt-2"></div>
                            </div>
                        </div>
                    </div>

                    <div class="card mt-4">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="fas fa-clock me-2"></i>Staging Files</h6>
                        </div>
                        <div class="card-body">
                            <div id="staging-files">
                                <!-- Staging files will be populated here -->
                            </div>
                            <button class="btn btn-outline-primary w-100 mt-2" onclick="refreshStagingFiles()">
                                <i class="fas fa-refresh me-2"></i>Refresh
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- RAG/Ask AI Tab -->
        <div id="rag-tab" class="tab-content d-none fade-in">
            <div class="row">
                <div class="col-md-8 mx-auto">
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="fas fa-question-circle me-2"></i>Ask AI About Your Documents</h6>
                        </div>
                        <div class="card-body">
                            <!-- Mode Selection -->
                            <div class="mb-4">
                                <div class="btn-group w-100" role="group">
                                    <input type="radio" class="btn-check" name="rag-mode" id="rag-auto" value="auto"
                                        checked onchange="toggleRagMode()">
                                    <label class="btn btn-outline-primary" for="rag-auto">
                                        <i class="fas fa-magic-wand-sparkles me-2"></i>Auto Search
                                    </label>

                                    <input type="radio" class="btn-check" name="rag-mode" id="rag-manual" value="manual"
                                        onchange="toggleRagMode()">
                                    <label class="btn btn-outline-primary" for="rag-manual">
                                        <i class="fas fa-hand-pointer me-2"></i>Manual Selection
                                    </label>
                                </div>
                                <small class="text-muted d-block mt-1">
                                    Auto Search: AI finds relevant documents automatically | Manual Selection: You
                                    choose specific documents
                                </small>
                            </div>

                            <!-- Manual Document Selection -->
                            <div id="manual-doc-selection" class="mb-4 d-none">
                                <h6>Select Documents <button class="btn btn-sm btn-outline-secondary"
                                        onclick="loadDocumentsForSelection()"><i
                                            class="fas fa-refresh me-1"></i>Refresh</button></h6>
                                <div class="row">
                                    <div class="col-md-8">
                                        <!-- Search bar for documents -->
                                        <div class="mb-2">
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="fas fa-search"></i></span>
                                                <input type="text" id="manual-doc-search" class="form-control"
                                                    placeholder="Search documents by title, filename, or content..."
                                                    onkeyup="filterManualDocuments()">
                                                <button class="btn btn-outline-secondary" type="button"
                                                    onclick="clearManualSearch()">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div id="available-documents"
                                            style="max-height: 300px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 8px; padding: 1rem;">
                                            <div class="text-center text-muted">
                                                <i class="fas fa-spinner fa-spin"></i> Loading documents...
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <h6>Selected Documents <span id="selected-count"
                                                class="badge bg-primary">0</span></h6>
                                        <div id="selected-docs-list"
                                            style="max-height: 300px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 8px; padding: 1rem;">
                                            <div class="text-muted text-center">No documents selected</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-4">
                                <label for="rag-question" class="form-label">Your Question</label>
                                <textarea id="rag-question" class="form-control" rows="3"
                                    placeholder="Ask any question about your documents..."></textarea>
                            </div>
                            <button class="btn btn-primary" onclick="askAI()">
                                <i class="fas fa-brain me-2"></i>Ask AI
                            </button>
                            <div id="rag-loading" class="d-none mt-3">
                                <div class="text-center">
                                    <div class="spinner-border" role="status">
                                        <span class="visually-hidden">Thinking...</span>
                                    </div>
                                    <p class="mt-2">AI is analyzing your documents...</p>
                                </div>
                            </div>
                            <div id="rag-response" class="mt-4 d-none">
                                <h6>AI Response</h6>
                                <div id="rag-answer" class="alert alert-info" style="white-space: pre-wrap;"></div>
                                <h6>Source Documents</h6>
                                <div id="rag-sources" class="row g-2"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Manage Tab -->
        <div id="manage-tab" class="tab-content d-none fade-in">
            <div class="row">
                <div class="col-md-4">
                    <div class="card manage-card">
                        <div class="card-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h6 class="mb-0"><i class="fas fa-users me-2"></i>Correspondents</h6>
                                <span class="badge bg-primary" id="correspondents-count">0</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="manage-controls mb-3">
                                <div class="mb-2">
                                    <input type="text" id="search-correspondents" class="form-control form-control-sm"
                                        placeholder="Search correspondents..."
                                        onkeyup="filterManageList('correspondents')">
                                </div>
                                <button class="btn btn-primary w-100 btn-sm" onclick="showCorrespondentModal()">
                                    <i class="fas fa-plus me-2"></i>Add Correspondent
                                </button>
                            </div>
                            <div class="manage-list-container">
                                <div id="correspondents-list" class="manage-list">
                                    <!-- Correspondents will be populated here -->
                                </div>
                                <div id="correspondents-pagination" class="manage-pagination d-none">
                                    <!-- Pagination controls -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card manage-card">
                        <div class="card-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h6 class="mb-0"><i class="fas fa-file-alt me-2"></i>Document Types</h6>
                                <span class="badge bg-primary" id="doctypes-count">0</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="manage-controls mb-3">
                                <div class="mb-2">
                                    <input type="text" id="search-doctypes" class="form-control form-control-sm"
                                        placeholder="Search document types..." onkeyup="filterManageList('doctypes')">
                                </div>
                                <div class="mb-2">
                                    <input type="text" id="new-doctype" class="form-control"
                                        placeholder="New document type"
                                        onkeypress="handleManageInputKeyPress(event, 'doctype')">
                                </div>
                                <button class="btn btn-primary w-100 btn-sm" onclick="addDocType()">
                                    <i class="fas fa-plus me-2"></i>Add Document Type
                                </button>
                            </div>
                            <div class="manage-list-container">
                                <div id="doctypes-list" class="manage-list">
                                    <!-- Document types will be populated here -->
                                </div>
                                <div id="doctypes-pagination" class="manage-pagination d-none">
                                    <!-- Pagination controls -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card manage-card">
                        <div class="card-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h6 class="mb-0"><i class="fas fa-tags me-2"></i>Tags</h6>
                                <span class="badge bg-primary" id="tags-count">0</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="manage-controls mb-3">
                                <div class="mb-2">
                                    <input type="text" id="search-tags" class="form-control form-control-sm"
                                        placeholder="Search tags..." onkeyup="filterManageList('tags')">
                                </div>
                                <div class="mb-2">
                                    <input type="text" id="new-tag" class="form-control mb-2" placeholder="New tag name"
                                        onkeypress="handleManageInputKeyPress(event, 'tag')">
                                    <div class="input-group">
                                        <span class="input-group-text">Color</span>
                                        <input type="color" class="form-control form-control-color" id="new-tag-color"
                                            value="#64748b" title="Choose tag color">
                                    </div>
                                </div>
                                <button class="btn btn-primary w-100 btn-sm" onclick="addTag()">
                                    <i class="fas fa-plus me-2"></i>Add Tag
                                </button>
                            </div>
                            <div class="manage-list-container">
                                <div id="tags-list" class="manage-list">
                                    <!-- Tags will be populated here -->
                                </div>
                                <div id="tags-pagination" class="manage-pagination d-none">
                                    <!-- Pagination controls -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings-tab" class="tab-content d-none fade-in">
            <!-- Settings Header with Actions -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h4 class="mb-1">
                                <i class="fas fa-cogs me-2 text-primary"></i>System Settings
                            </h4>
                            <p class="text-muted mb-0">Configure your document management system</p>
                        </div>
                        <div class="btn-group">
                            <button class="btn btn-outline-light" onclick="showSetupWizard()" title="Setup Wizard">
                                <i class="fas fa-magic me-2"></i>Setup Wizard
                            </button>
                            <button class="btn btn-outline-light" onclick="showSetupAssistant()"
                                title="Setup Assistant">
                                <i class="fas fa-question-circle me-2"></i>Help
                            </button>
                            <button class="btn btn-success" onclick="exportSettings()" title="Export Configuration">
                                <i class="fas fa-download me-2"></i>Export
                            </button>
                            <button class="btn btn-warning" onclick="importSettings()" title="Import Configuration">
                                <i class="fas fa-upload me-2"></i>Import
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tabs Navigation -->
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header p-0">
                            <ul class="nav nav-tabs card-header-tabs" id="settingsTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="ai-settings-tab" data-bs-toggle="tab"
                                        data-bs-target="#ai-settings-panel" type="button" role="tab">
                                        <i class="fas fa-brain me-2"></i>AI Configuration
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="database-settings-tab" data-bs-toggle="tab"
                                        data-bs-target="#database-settings-panel" type="button" role="tab">
                                        <i class="fas fa-database me-2"></i>Database
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="folder-settings-tab" data-bs-toggle="tab"
                                        data-bs-target="#folder-settings-panel" type="button" role="tab">
                                        <i class="fas fa-folder me-2"></i>Folders
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="ocr-settings-tab" data-bs-toggle="tab"
                                        data-bs-target="#ocr-settings-panel" type="button" role="tab">
                                        <i class="fas fa-eye me-2"></i>OCR
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="file-settings-tab" data-bs-toggle="tab"
                                        data-bs-target="#file-settings-panel" type="button" role="tab">
                                        <i class="fas fa-file-alt me-2"></i>Files
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="system-settings-tab" data-bs-toggle="tab"
                                        data-bs-target="#system-settings-panel" type="button" role="tab">
                                        <i class="fas fa-server me-2"></i>System
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="users-settings-tab" data-bs-toggle="tab"
                                        data-bs-target="#users-settings-panel" type="button" role="tab">
                                        <i class="fas fa-users me-2"></i>Users
                                    </button>
                                </li>
                            </ul>
                        </div>
                        <div class="card-body">
                            <div class="tab-content" id="settingsTabContent">
                                <!-- AI Configuration Panel -->
                                <div class="tab-pane fade show active" id="ai-settings-panel" role="tabpanel">
                                    <!-- AI Provider Selection -->
                                    <div class="row mb-4">
                                        <div class="col-12">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h6 class="mb-0"><i class="fas fa-robot me-2"></i>AI Provider
                                                        Selection</h6>
                                                </div>
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <div class="form-check mb-3">
                                                                <input class="form-check-input" type="radio"
                                                                    name="ai-provider" id="provider-openai"
                                                                    value="openai" checked>
                                                                <label class="form-check-label" for="provider-openai">
                                                                    <strong>OpenAI</strong> - Direct OpenAI API
                                                                    <div class="text-muted small">Use OpenAI's API
                                                                        directly with your API key</div>
                                                                </label>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="form-check mb-3">
                                                                <input class="form-check-input" type="radio"
                                                                    name="ai-provider" id="provider-azure"
                                                                    value="azure">
                                                                <label class="form-check-label" for="provider-azure">
                                                                    <strong>Azure OpenAI</strong> - Microsoft Azure
                                                                    <div class="text-muted small">Use OpenAI models
                                                                        through Azure with enterprise features</div>
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div id="ai-provider-status" class="alert alert-info d-none mt-3">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- OpenAI Configuration Row -->
                                    <div class="row" id="openai-config-section">
                                        <div class="col-md-6">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h6 class="mb-0"><i class="fas fa-key me-2"></i>OpenAI Configuration
                                                    </h6>
                                                </div>
                                                <div class="card-body">
                                                    <div class="mb-3">
                                                        <label for="openai-api-key" class="form-label">API Key</label>
                                                        <input type="text" id="openai-api-key" class="form-control"
                                                            placeholder="Enter your OpenAI API key"
                                                            autocomplete="new-password"
                                                            style="-webkit-text-security: disc; -moz-text-security: disc; text-security: disc;">
                                                        <div class="form-text">
                                                            Get your API key from <a
                                                                href="https://platform.openai.com/api-keys"
                                                                target="_blank">OpenAI Platform</a>
                                                        </div>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label for="embedding-model" class="form-label">Embedding
                                                            Model</label>
                                                        <select id="embedding-model" class="form-select">
                                                            <option value="text-embedding-ada-002">
                                                                text-embedding-ada-002 ($0.10/1M tokens)</option>
                                                            <option value="text-embedding-3-small">
                                                                text-embedding-3-small ($0.02/1M tokens) - Recommended
                                                            </option>
                                                            <option value="text-embedding-3-large">
                                                                text-embedding-3-large ($0.13/1M tokens)</option>
                                                        </select>
                                                    </div>

                                                    <hr class="my-3">
                                                    <h6 class="mb-3"><i class="fas fa-robot me-2"></i>Model Selection
                                                    </h6>

                                                    <div class="mb-3">
                                                        <label for="chat-model" class="form-label">Chat Model
                                                            (RAG/Q&A)</label>
                                                        <select id="chat-model" class="form-select">
                                                            <option value="gpt-4o-mini">GPT-4o Mini ($0.15/$0.60 per 1M)
                                                                - Recommended</option>
                                                            <option value="gpt-4o-mini-2024-07-18">GPT-4o Mini
                                                                2024-07-18 ($0.15/$0.60 per 1M) - Structured Output
                                                            </option>
                                                            <option value="gpt-4o">GPT-4o ($5.00/$15.00 per 1M)</option>
                                                            <option value="gpt-4o-2024-08-06">GPT-4o 2024-08-06
                                                                ($2.50/$10.00 per 1M) - Structured Output</option>
                                                            <option value="gpt-4o-2024-11-20">GPT-4o 2024-11-20
                                                                ($2.50/$10.00 per 1M) - Latest</option>
                                                            <option value="gpt-4-turbo">GPT-4 Turbo ($10.00/$30.00 per
                                                                1M)</option>
                                                            <option value="gpt-4-turbo-2024-04-09">GPT-4 Turbo
                                                                2024-04-09 ($10.00/$30.00 per 1M)</option>
                                                            <option value="gpt-4">GPT-4 ($30.00/$60.00 per 1M)</option>
                                                            <option value="gpt-4-0613">GPT-4 0613 ($30.00/$60.00 per 1M)
                                                            </option>
                                                            <option value="gpt-3.5-turbo">GPT-3.5 Turbo ($0.50/$1.50 per
                                                                1M)</option>
                                                            <option value="gpt-3.5-turbo-0125">GPT-3.5 Turbo 0125
                                                                ($0.50/$1.50 per 1M)</option>
                                                            <option value="o1-mini">o1-mini ($3.00/$12.00 per 1M) -
                                                                Reasoning</option>
                                                            <option value="o1-mini-2024-09-12">o1-mini 2024-09-12
                                                                ($3.00/$12.00 per 1M)</option>
                                                            <option value="o1-preview">o1-preview ($15.00/$60.00 per 1M)
                                                                - Advanced Reasoning</option>
                                                            <option value="o1-preview-2024-09-12">o1-preview 2024-09-12
                                                                ($15.00/$60.00 per 1M)</option>
                                                        </select>
                                                        <div class="form-text">
                                                            Model used for answering questions about documents
                                                        </div>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label for="analysis-model" class="form-label">Analysis Model
                                                            (Document Processing)</label>
                                                        <select id="analysis-model" class="form-select">
                                                            <option value="gpt-4o-mini">GPT-4o Mini ($0.15/$0.60 per 1M)
                                                                - Recommended</option>
                                                            <option value="gpt-4o-mini-2024-07-18">GPT-4o Mini
                                                                2024-07-18 ($0.15/$0.60 per 1M) - Structured Output
                                                            </option>
                                                            <option value="gpt-4o">GPT-4o ($5.00/$15.00 per 1M)</option>
                                                            <option value="gpt-4o-2024-08-06">GPT-4o 2024-08-06
                                                                ($2.50/$10.00 per 1M) - Structured Output</option>
                                                            <option value="gpt-4o-2024-11-20">GPT-4o 2024-11-20
                                                                ($2.50/$10.00 per 1M) - Latest</option>
                                                            <option value="gpt-4-turbo">GPT-4 Turbo ($10.00/$30.00 per
                                                                1M)</option>
                                                            <option value="gpt-4-turbo-2024-04-09">GPT-4 Turbo
                                                                2024-04-09 ($10.00/$30.00 per 1M)</option>
                                                            <option value="gpt-4">GPT-4 ($30.00/$60.00 per 1M)</option>
                                                            <option value="gpt-4-0613">GPT-4 0613 ($30.00/$60.00 per 1M)
                                                            </option>
                                                            <option value="gpt-3.5-turbo">GPT-3.5 Turbo ($0.50/$1.50 per
                                                                1M)</option>
                                                            <option value="gpt-3.5-turbo-0125">GPT-3.5 Turbo 0125
                                                                ($0.50/$1.50 per 1M)</option>
                                                        </select>
                                                        <div class="form-text">
                                                            Model used for extracting metadata from documents
                                                        </div>
                                                    </div>

                                                    <div class="d-grid gap-2">
                                                        <button class="btn btn-primary" onclick="saveOpenAIConfig()">
                                                            <i class="fas fa-save me-2"></i>Save Configuration
                                                        </button>
                                                        <button class="btn btn-outline-secondary" onclick="testAI()">
                                                            <i class="fas fa-vial me-2"></i>Test AI Connection
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Azure OpenAI Configuration Row -->
                                    <div class="row d-none" id="azure-config-section">
                                        <div class="col-md-6">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h6 class="mb-0"><i class="fas fa-cloud me-2"></i>Azure OpenAI
                                                        Configuration</h6>
                                                </div>
                                                <div class="card-body">
                                                    <div class="alert alert-info mb-3">
                                                        <i class="fas fa-info-circle me-2"></i>
                                                        <strong>Note:</strong> Azure OpenAI uses deployment names
                                                        instead of model names. Create deployments in your Azure portal
                                                        for both chat and embeddings models.
                                                    </div>
                                                    <div class="mb-3">
                                                        <label for="azure-api-key" class="form-label">API Key</label>
                                                        <input type="text" id="azure-api-key" class="form-control"
                                                            placeholder="Enter your Azure OpenAI API key"
                                                            autocomplete="new-password"
                                                            style="-webkit-text-security: disc; -moz-text-security: disc; text-security: disc;">
                                                    </div>
                                                    <div class="mb-3">
                                                        <label for="azure-endpoint" class="form-label">Endpoint
                                                            URL</label>
                                                        <input type="text" id="azure-endpoint" class="form-control"
                                                            placeholder="https://your-resource.openai.azure.com/">
                                                        <div class="form-text">Your Azure OpenAI resource endpoint</div>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label for="azure-chat-deployment" class="form-label">Chat Model
                                                            Deployment Name</label>
                                                        <input type="text" id="azure-chat-deployment"
                                                            class="form-control" placeholder="e.g., gpt-4o-deployment">
                                                        <div class="form-text">Your Azure deployment name for
                                                            chat/analysis</div>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label for="azure-embeddings-deployment"
                                                            class="form-label">Embeddings Deployment Name</label>
                                                        <input type="text" id="azure-embeddings-deployment"
                                                            class="form-control"
                                                            placeholder="e.g., embeddings-deployment">
                                                        <div class="form-text">Your Azure deployment name for embeddings
                                                        </div>
                                                    </div>
                                                    <div class="d-grid gap-2">
                                                        <button class="btn btn-primary" onclick="saveAzureConfig()">
                                                            <i class="fas fa-save me-2"></i>Save Configuration
                                                        </button>
                                                        <button class="btn btn-outline-secondary" onclick="testAI()">
                                                            <i class="fas fa-vial me-2"></i>Test Azure Connection
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- AI Processing Limits (shared for all providers) -->
                                    <div class="row mt-3">
                                        <div class="col-md-6">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h6 class="mb-0"><i class="fas fa-sliders me-2"></i>AI Processing
                                                        Limits</h6>
                                                </div>
                                                <div class="card-body">
                                                    <div class="mb-3">
                                                        <label for="ai-text-limit" class="form-label">
                                                            Document Text Limit
                                                            <small class="text-muted">(Characters per document)</small>
                                                        </label>
                                                        <div class="input-group">
                                                            <input type="number" id="ai-text-limit" class="form-control"
                                                                min="1000" max="100000" step="1000" value="16000">
                                                            <span class="input-group-text">chars</span>
                                                        </div>
                                                        <div class="form-text">
                                                            Maximum characters to analyze per document (1,000 - 100,000)
                                                        </div>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label for="ai-context-limit" class="form-label">
                                                            RAG Context Limit
                                                            <small class="text-muted">(Characters for Q&A)</small>
                                                        </label>
                                                        <div class="input-group">
                                                            <input type="number" id="ai-context-limit"
                                                                class="form-control" min="1000" max="100000" step="1000"
                                                                value="10000">
                                                            <span class="input-group-text">chars</span>
                                                        </div>
                                                        <div class="form-text">
                                                            Maximum context size for AI Q&A responses (1,000 - 100,000)
                                                        </div>
                                                    </div>
                                                    <button class="btn btn-primary w-100" onclick="saveAILimits()">
                                                        <i class="fas fa-save me-2"></i>Save AI Limits
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Database Configuration Panel -->
                                <div class="tab-pane fade" id="database-settings-panel" role="tabpanel">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h6 class="mb-0"><i class="fas fa-database me-2"></i>SQLite Database
                                                    </h6>
                                                </div>
                                                <div class="card-body">
                                                    <div class="mb-3">
                                                        <label for="database-url" class="form-label">Database
                                                            URL</label>
                                                        <input type="text" id="database-url" class="form-control"
                                                            placeholder="sqlite:///./data/documents.db" readonly>
                                                        <div class="form-text">
                                                            SQLite database location (currently not configurable)
                                                        </div>
                                                    </div>
                                                    <div class="d-grid gap-2">
                                                        <button class="btn btn-outline-info"
                                                            onclick="checkDatabaseHealth()">
                                                            <i class="fas fa-stethoscope me-2"></i>Check Database Health
                                                        </button>
                                                        <button class="btn btn-outline-warning"
                                                            onclick="vacuumDatabase()">
                                                            <i class="fas fa-broom me-2"></i>Optimize Database
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h6 class="mb-0"><i class="fas fa-vector-square me-2"></i>Vector
                                                        Database (ChromaDB)</h6>
                                                </div>
                                                <div class="card-body">
                                                    <div class="mb-3">
                                                        <label for="chroma-host" class="form-label">ChromaDB
                                                            Host</label>
                                                        <input type="text" id="chroma-host" class="form-control"
                                                            placeholder="localhost" value="localhost">
                                                    </div>
                                                    <div class="mb-3">
                                                        <label for="chroma-port" class="form-label">ChromaDB
                                                            Port</label>
                                                        <input type="number" id="chroma-port" class="form-control"
                                                            placeholder="8001" value="8001" min="1" max="65535">
                                                    </div>
                                                    <div class="mb-3">
                                                        <label for="chroma-collection" class="form-label">Collection
                                                            Name</label>
                                                        <input type="text" id="chroma-collection" class="form-control"
                                                            placeholder="documents" value="documents">
                                                    </div>
                                                    <div class="d-grid gap-2">
                                                        <button class="btn btn-warning"
                                                            onclick="revectorizeAllDocuments()">
                                                            <i class="fas fa-sync-alt me-2"></i>Revectorize All
                                                            Documents
                                                        </button>
                                                        <button class="btn btn-outline-info" onclick="getVectorStats()">
                                                            <i class="fas fa-chart-bar me-2"></i>Vector Statistics
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Folder Configuration Panel -->
                                <div class="tab-pane fade" id="folder-settings-panel" role="tabpanel">
                                    <div class="row">
                                        <div class="col-12">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h6 class="mb-0"><i class="fas fa-folder-tree me-2"></i>Folder
                                                        Configuration</h6>
                                                </div>
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <div class="mb-3">
                                                                <label for="root-folder" class="form-label">Root
                                                                    Folder</label>
                                                                <div class="input-group">
                                                                    <input type="text" id="root-folder"
                                                                        class="form-control"
                                                                        placeholder="/path/to/document/management"
                                                                        readonly>
                                                                    <button class="btn btn-outline-secondary"
                                                                        onclick="selectRootFolder()">
                                                                        <i class="fas fa-folder-open"></i>
                                                                    </button>
                                                                </div>
                                                                <div class="form-text">Base directory for the document
                                                                    management system</div>
                                                            </div>
                                                            <div class="mb-3">
                                                                <label for="staging-folder" class="form-label">Staging
                                                                    Folder</label>
                                                                <input type="text" id="staging-folder"
                                                                    class="form-control" placeholder="data/staging"
                                                                    value="data/staging">
                                                                <div class="form-text">Folder for documents waiting to
                                                                    be processed</div>
                                                            </div>
                                                            <div class="mb-3">
                                                                <label for="storage-folder" class="form-label">Storage
                                                                    Folder</label>
                                                                <input type="text" id="storage-folder"
                                                                    class="form-control" placeholder="data/storage"
                                                                    value="data/storage">
                                                                <div class="form-text">Folder for organized, processed
                                                                    documents</div>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="mb-3">
                                                                <label for="data-folder" class="form-label">Data
                                                                    Folder</label>
                                                                <input type="text" id="data-folder" class="form-control"
                                                                    placeholder="data" value="data">
                                                                <div class="form-text">Folder for databases and internal
                                                                    data</div>
                                                            </div>
                                                            <div class="mb-3">
                                                                <label for="logs-folder" class="form-label">Logs
                                                                    Folder</label>
                                                                <input type="text" id="logs-folder" class="form-control"
                                                                    placeholder="data/logs" value="data/logs">
                                                                <div class="form-text">Folder for application logs</div>
                                                            </div>
                                                            <div class="d-grid gap-2 mt-4">
                                                                <button class="btn btn-primary"
                                                                    onclick="saveFolderSettings()">
                                                                    <i class="fas fa-save me-2"></i>Save Folder Settings
                                                                </button>
                                                                <button class="btn btn-outline-info"
                                                                    onclick="checkFolderStructure()">
                                                                    <i class="fas fa-folder-plus me-2"></i>Create
                                                                    Missing Folders
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- OCR Configuration Panel -->
                                <div class="tab-pane fade" id="ocr-settings-panel" role="tabpanel">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h6 class="mb-0"><i class="fas fa-eye me-2"></i>Tesseract OCR</h6>
                                                </div>
                                                <div class="card-body">
                                                    <div class="mb-3">
                                                        <label for="tesseract-path" class="form-label">Tesseract
                                                            Executable Path</label>
                                                        <div class="input-group">
                                                            <input type="text" id="tesseract-path" class="form-control"
                                                                placeholder="/usr/bin/tesseract">
                                                            <button class="btn btn-outline-secondary"
                                                                onclick="detectTesseract()">
                                                                <i class="fas fa-search"></i>
                                                            </button>
                                                        </div>
                                                        <div class="form-text">Path to the Tesseract OCR executable
                                                        </div>
                                                    </div>
                                                    <div class="d-grid gap-2">
                                                        <button class="btn btn-outline-info" onclick="testOCR()">
                                                            <i class="fas fa-vial me-2"></i>Test OCR
                                                        </button>
                                                        <button class="btn btn-outline-secondary"
                                                            onclick="installTesseract()">
                                                            <i class="fas fa-download me-2"></i>Install Tesseract
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h6 class="mb-0"><i class="fas fa-file-pdf me-2"></i>PDF Processing
                                                        (Poppler)</h6>
                                                </div>
                                                <div class="card-body">
                                                    <div class="mb-3">
                                                        <label for="poppler-path" class="form-label">Poppler Tools
                                                            Path</label>
                                                        <div class="input-group">
                                                            <input type="text" id="poppler-path" class="form-control"
                                                                placeholder="/usr/bin">
                                                            <button class="btn btn-outline-secondary"
                                                                onclick="detectPoppler()">
                                                                <i class="fas fa-search"></i>
                                                            </button>
                                                        </div>
                                                        <div class="form-text">Path to Poppler utilities (pdftoppm,
                                                            pdfinfo, etc.)</div>
                                                    </div>
                                                    <div class="d-grid gap-2">
                                                        <button class="btn btn-outline-info"
                                                            onclick="testPDFProcessing()">
                                                            <i class="fas fa-vial me-2"></i>Test PDF Processing
                                                        </button>
                                                        <button class="btn btn-outline-secondary"
                                                            onclick="installPoppler()">
                                                            <i class="fas fa-download me-2"></i>Install Poppler
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- File Settings Panel -->
                                <div class="tab-pane fade" id="file-settings-panel" role="tabpanel">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h6 class="mb-0"><i class="fas fa-file-upload me-2"></i>File Upload
                                                        Settings</h6>
                                                </div>
                                                <div class="card-body">
                                                    <div class="mb-3">
                                                        <label for="max-file-size" class="form-label">Maximum File
                                                            Size</label>
                                                        <div class="input-group">
                                                            <input type="number" id="max-file-size" class="form-control"
                                                                placeholder="52428800" value="52428800" min="1024">
                                                            <span class="input-group-text">bytes</span>
                                                        </div>
                                                        <div class="form-text">Maximum size for uploaded files (52MB =
                                                            52428800 bytes)</div>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label for="allowed-extensions" class="form-label">Allowed File
                                                            Extensions</label>
                                                        <input type="text" id="allowed-extensions" class="form-control"
                                                            placeholder=".pdf,.png,.jpg,.jpeg,.tiff,.bmp"
                                                            value=".pdf,.png,.jpg,.jpeg,.tiff,.bmp">
                                                        <div class="form-text">Comma-separated list of allowed file
                                                            extensions</div>
                                                    </div>
                                                    <button class="btn btn-primary w-100" onclick="saveFileSettings()">
                                                        <i class="fas fa-save me-2"></i>Save File Settings
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h6 class="mb-0"><i class="fas fa-chart-bar me-2"></i>File
                                                        Statistics</h6>
                                                </div>
                                                <div class="card-body">
                                                    <div id="file-stats">
                                                        <!-- File statistics will be populated here -->
                                                    </div>
                                                    <button class="btn btn-outline-primary w-100 mt-3"
                                                        onclick="refreshFileStats()">
                                                        <i class="fas fa-refresh me-2"></i>Refresh Statistics
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- System Settings Panel -->
                                <div class="tab-pane fade" id="system-settings-panel" role="tabpanel">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h6 class="mb-0"><i class="fas fa-heartbeat me-2"></i>System Health
                                                    </h6>
                                                </div>
                                                <div class="card-body">
                                                    <div id="health-status">
                                                        <!-- Health status will be populated here -->
                                                    </div>
                                                    <button class="btn btn-outline-primary w-100 mt-3"
                                                        onclick="checkSettingsHealth()">
                                                        <i class="fas fa-sync me-2"></i>Refresh Health Check
                                                    </button>
                                                </div>
                                            </div>

                                            <div class="card mt-4">
                                                <div class="card-header">
                                                    <h6 class="mb-0"><i class="fas fa-chart-bar me-2"></i>System
                                                        Statistics</h6>
                                                </div>
                                                <div class="card-body">
                                                    <div id="system-stats">
                                                        <!-- Stats will be populated here -->
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h6 class="mb-0"><i class="fas fa-cog me-2"></i>System Configuration
                                                    </h6>
                                                </div>
                                                <div class="card-body">
                                                    <div class="mb-3">
                                                        <label for="log-level" class="form-label">Log Level</label>
                                                        <select id="log-level" class="form-select">
                                                            <option value="DEBUG">DEBUG</option>
                                                            <option value="INFO" selected>INFO</option>
                                                            <option value="WARNING">WARNING</option>
                                                            <option value="ERROR">ERROR</option>
                                                            <option value="CRITICAL">CRITICAL</option>
                                                        </select>
                                                        <div class="form-text">Set the application logging level</div>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label for="secret-key" class="form-label">Secret Key</label>
                                                        <div class="input-group">
                                                            <input type="text" id="secret-key" class="form-control"
                                                                placeholder="Your secret key"
                                                                autocomplete="new-password"
                                                                style="-webkit-text-security: disc; -moz-text-security: disc; text-security: disc;">
                                                            <button class="btn btn-outline-secondary"
                                                                onclick="generateSecretKey()">
                                                                <i class="fas fa-key"></i>
                                                            </button>
                                                        </div>
                                                        <div class="form-text">Secret key for application security</div>
                                                    </div>
                                                    <button class="btn btn-primary w-100"
                                                        onclick="saveSystemSettings()">
                                                        <i class="fas fa-save me-2"></i>Save System Settings
                                                    </button>
                                                </div>
                                            </div>

                                            <div class="card mt-4">
                                                <div class="card-header">
                                                    <h6 class="mb-0"><i class="fas fa-list me-2"></i>Recent Logs</h6>
                                                </div>
                                                <div class="card-body">
                                                    <div id="recent-logs" style="max-height: 300px; overflow-y: auto;">
                                                        <!-- Logs will be populated here -->
                                                    </div>
                                                    <button class="btn btn-outline-primary w-100 mt-2"
                                                        onclick="refreshLogs()">
                                                        <i class="fas fa-refresh me-2"></i>Refresh Logs
                                                    </button>
                                                    <button class="btn btn-outline-success w-100 mt-2"
                                                        onclick="downloadLogs()">
                                                        <i class="fas fa-download me-2"></i>Download All Logs
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Users Management Panel -->
                                <div class="tab-pane fade" id="users-settings-panel" role="tabpanel">
                                    <!-- User Management Header -->
                                    <div class="row mb-4">
                                        <div class="col-12">
                                            <div class="bg-gradient-primary text-white p-4 rounded-3 shadow-sm">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <div>
                                                        <h4 class="mb-1"><i
                                                                class="fas fa-users me-3"></i>Benutzerverwaltung</h4>
                                                        <p class="mb-0 opacity-75">Verwalte Benutzer, Rollen und
                                                            Berechtigungen</p>
                                                    </div>
                                                    <button class="btn btn-light btn-lg" onclick="showAddUserModal()">
                                                        <i class="fas fa-user-plus me-2"></i>Neuer Benutzer
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Statistics Cards Row -->
                                    <div class="row mb-4" id="user-stats-row">
                                        <div class="col-md-3">
                                            <div class="card border-0 shadow-sm">
                                                <div class="card-body text-center">
                                                    <div class="rounded-circle bg-primary bg-opacity-10 d-inline-flex align-items-center justify-content-center mb-2"
                                                        style="width: 50px; height: 50px;">
                                                        <i class="fas fa-users text-primary fa-lg"></i>
                                                    </div>
                                                    <h3 class="mb-1" id="total-users-count">-</h3>
                                                    <small class="text-muted">Gesamt Benutzer</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card border-0 shadow-sm">
                                                <div class="card-body text-center">
                                                    <div class="rounded-circle bg-success bg-opacity-10 d-inline-flex align-items-center justify-content-center mb-2"
                                                        style="width: 50px; height: 50px;">
                                                        <i class="fas fa-user-check text-success fa-lg"></i>
                                                    </div>
                                                    <h3 class="mb-1" id="active-users-count">-</h3>
                                                    <small class="text-muted">Aktive Benutzer</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card border-0 shadow-sm">
                                                <div class="card-body text-center">
                                                    <div class="rounded-circle bg-warning bg-opacity-10 d-inline-flex align-items-center justify-content-center mb-2"
                                                        style="width: 50px; height: 50px;">
                                                        <i class="fas fa-user-shield text-warning fa-lg"></i>
                                                    </div>
                                                    <h3 class="mb-1" id="admin-users-count">-</h3>
                                                    <small class="text-muted">Administratoren</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card border-0 shadow-sm">
                                                <div class="card-body text-center">
                                                    <div class="rounded-circle bg-info bg-opacity-10 d-inline-flex align-items-center justify-content-center mb-2"
                                                        style="width: 50px; height: 50px;">
                                                        <i class="fas fa-clock text-info fa-lg"></i>
                                                    </div>
                                                    <h3 class="mb-1" id="recent-logins-count">-</h3>
                                                    <small class="text-muted">Letzte 24h Logins</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <!-- Users List Panel -->
                                        <div class="col-lg-8">
                                            <div class="card glass-card">
                                                <div class="card-header glass-header p-3">
                                                    <div class="d-flex justify-content-between align-items-center">
                                                        <h6 class="mb-0"><i class="fas fa-users me-2"></i>Benutzer Liste
                                                        </h6>
                                                        <div class="d-flex gap-2">
                                                            <input type="text" class="form-control form-control-sm"
                                                                style="width: 200px;" placeholder="Suchen..."
                                                                id="user-search-input">
                                                            <button class="btn btn-sm btn-outline-light"
                                                                onclick="loadUsers()" title="Aktualisieren">
                                                                <i class="fas fa-sync-alt"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="card-body p-0" style="max-height: 400px; overflow-y: auto;">
                                                    <div id="users-list">
                                                        <!-- Users list will be populated here -->
                                                        <div class="text-center py-3">
                                                            <div class="spinner-border spinner-border-sm text-primary"
                                                                role="status">
                                                                <span class="visually-hidden">Loading...</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Current User & Actions Panel -->
                                        <div class="col-lg-4">
                                            <!-- Current User Info -->
                                            <div class="card border-0 shadow-sm mb-4">
                                                <div class="card-header bg-transparent border-0 p-4">
                                                    <h5 class="mb-0"><i
                                                            class="fas fa-user-circle me-2 text-success"></i>Mein Profil
                                                    </h5>
                                                </div>
                                                <div class="card-body p-4">
                                                    <div id="current-user-info" class="text-center">
                                                        <!-- Current user info will be populated here -->
                                                        <div class="spinner-border text-primary" role="status">
                                                            <span class="visually-hidden">Loading...</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Password Change Card -->
                                            <div class="card border-0 shadow-sm mb-4">
                                                <div class="card-header bg-transparent border-0 p-4">
                                                    <h5 class="mb-0"><i
                                                            class="fas fa-lock me-2 text-warning"></i>Passwort ändern
                                                    </h5>
                                                </div>
                                                <div class="card-body p-4">
                                                    <form id="change-password-form">
                                                        <!-- Hidden username field for accessibility -->
                                                        <input type="text" name="username" autocomplete="username"
                                                            style="display: none;">
                                                        <div class="mb-3">
                                                            <label for="current-password"
                                                                class="form-label fw-semibold">
                                                                <i class="fas fa-key me-1 text-muted"></i>Aktuelles
                                                                Passwort
                                                            </label>
                                                            <input type="password" class="form-control"
                                                                id="current-password" required
                                                                autocomplete="current-password">
                                                        </div>
                                                        <div class="mb-3">
                                                            <label for="new-password" class="form-label fw-semibold">
                                                                <i class="fas fa-unlock-alt me-1 text-muted"></i>Neues
                                                                Passwort
                                                            </label>
                                                            <input type="password" class="form-control"
                                                                id="new-password" required minlength="8"
                                                                autocomplete="new-password">
                                                            <div class="form-text">Mindestens 8 Zeichen</div>
                                                        </div>
                                                        <div class="mb-4">
                                                            <label for="confirm-password"
                                                                class="form-label fw-semibold">
                                                                <i
                                                                    class="fas fa-check-circle me-1 text-muted"></i>Passwort
                                                                bestätigen
                                                            </label>
                                                            <input type="password" class="form-control"
                                                                id="confirm-password" required
                                                                autocomplete="new-password">
                                                        </div>
                                                        <button type="submit" class="btn btn-warning w-100 fw-semibold">
                                                            <i class="fas fa-save me-2"></i>Passwort aktualisieren
                                                        </button>
                                                    </form>
                                                </div>
                                            </div>

                                            <!-- Logout Section -->
                                            <div class="card border-0 shadow-sm">
                                                <div class="card-body p-4 text-center">
                                                    <i class="fas fa-sign-out-alt fa-2x text-danger mb-3"></i>
                                                    <h6 class="mb-3">Sitzung beenden</h6>
                                                    <p class="text-muted small mb-3">Melde dich sicher vom System ab</p>
                                                    <button class="btn btn-danger w-100 fw-semibold" onclick="logout()">
                                                        <i class="fas fa-sign-out-alt me-2"></i>Abmelden
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- About Tab -->
        <div id="about-tab" class="tab-content d-none fade-in">
            <div class="row">
                <div class="col-12">
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h4 class="card-title mb-4">
                                <i class="fas fa-info-circle me-2 text-primary"></i>About DocuManager
                            </h4>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-4">
                                        <h5 class="text-muted mb-3">Created by Jannik Reinhard and Fabian Peschke</h5>
                                        <ul class="list-unstyled">
                                            <li><i class="fas fa-cloud me-2 text-primary"></i>Cloud Solutions</li>
                                            <li><i class="fas fa-desktop me-2 text-primary"></i>Endpoint Management</li>
                                            <li><i class="fas fa-brain me-2 text-primary"></i>AI Application Consulting
                                                & Engineering</li>
                                        </ul>
                                        <p class="mt-3">
                                            <i class="fas fa-envelope me-2"></i>Contact: <a
                                                href="mailto:hi@visqo.com">hi@visqo.com</a>
                                        </p>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="mb-4">
                                        <h5 class="text-muted mb-3">Support This Project</h5>
                                        <div class="alert alert-light border">
                                            <i class="fas fa-heart text-danger me-2"></i>
                                            <strong>This is an open source project!</strong>
                                            <p class="mt-2 mb-0">
                                                If you find DocuManager useful, please consider supporting its
                                                development.
                                            </p>
                                        </div>
                                        <a href="https://www.buymeacoffee.com/jannikreinf" target="_blank">
                                            <img src="https://www.buymeacoffee.com/assets/img/custom_images/orange_img.png"
                                                alt="Buy Me A Coffee"
                                                style="height: 41px !important;width: 174px !important;box-shadow: 0px 3px 2px 0px rgba(190, 190, 190, 0.5) !important">
                                        </a>
                                    </div>
                                </div>
                            </div>

                            <hr class="my-4">

                            <div class="row">
                                <div class="col-12">
                                    <h5 class="text-muted mb-3">About DocuManager</h5>
                                    <p>
                                        DocuManager is a comprehensive document management system that combines powerful
                                        search capabilities,
                                        AI-powered document processing, and intuitive organization features. Built with
                                        modern web technologies
                                        and designed for ease of use, it helps you manage your documents efficiently.
                                    </p>
                                    <div class="mt-3">
                                        <span class="badge bg-secondary me-2">FastAPI</span>
                                        <span class="badge bg-secondary me-2">PostgreSQL</span>
                                        <span class="badge bg-secondary me-2">Bootstrap 5</span>
                                        <span class="badge bg-secondary me-2">OpenAI/Azure OpenAI</span>
                                        <span class="badge bg-secondary me-2">Tesseract OCR</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div> <!-- End main-content -->

    <!-- Footer Credit -->
    <div class="text-center py-3 text-muted">
        <small>
            Created with ❤️ by <a href="mailto:hi@visqo.com" class="text-decoration-none">Jannik Reinhard and Fabian Peschke</a>
        </small>
    </div>

    <!-- Document Viewer Modal -->
    <div class="modal fade" id="documentModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-file-alt me-2"></i>
                        <span id="modal-document-title">Document Viewer</span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0">
                    <div class="row g-0">
                        <!-- Document Viewer Panel -->
                        <div class="col-lg-8 border-end">
                            <div class="p-3">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h6 class="mb-0">Document Viewer</h6>
                                    <div class="btn-group btn-group-sm">
                                        <button type="button" class="btn btn-outline-secondary"
                                            onclick="downloadDocument()">
                                            <i class="fas fa-download"></i> Download
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary"
                                            onclick="openInNewTab()">
                                            <i class="fas fa-external-link-alt"></i> Open in Tab
                                        </button>
                                    </div>
                                </div>
                                <div id="document-viewer" class="document-viewer">
                                    <!-- Document content will be loaded here -->
                                </div>
                            </div>
                        </div>

                        <!-- Document Details Panel with Tabs -->
                        <div class="col-lg-4" style="display: flex; flex-direction: column; height: 100%;">
                            <div class="p-3" style="display: flex; flex-direction: column; height: 100%;">
                                <!-- Tab Navigation -->
                                <ul class="nav nav-tabs mb-3" id="documentTabs" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="metadata-tab" data-bs-toggle="tab"
                                            data-bs-target="#metadata-panel" type="button" role="tab">
                                            <i class="fas fa-info-circle me-1"></i>Metadata
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="additional-tab" data-bs-toggle="tab"
                                            data-bs-target="#additional-panel" type="button" role="tab">
                                            <i class="fas fa-plus-circle me-1"></i>Additional
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="logs-tab" data-bs-toggle="tab"
                                            data-bs-target="#logs-panel" type="button" role="tab">
                                            <i class="fas fa-list-alt me-1"></i>Logs
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="ocr-tab" data-bs-toggle="tab"
                                            data-bs-target="#ocr-panel" type="button" role="tab">
                                            <i class="fas fa-file-text me-1"></i>OCR
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="relations-tab" data-bs-toggle="tab"
                                            data-bs-target="#relations-panel" type="button" role="tab">
                                            <i class="fas fa-link me-1"></i>Relations
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="notes-tab" data-bs-toggle="tab"
                                            data-bs-target="#notes-panel" type="button" role="tab">
                                            <i class="fas fa-sticky-note me-1"></i>Notes
                                        </button>
                                    </li>
                                </ul>

                                <!-- Tab Content -->
                                <div class="tab-content" id="documentTabContent"
                                    style="flex: 1; overflow-y: auto; min-height: 0;">
                                    <!-- Metadata Tab -->
                                    <div class="tab-pane" id="metadata-panel" role="tabpanel">
                                        <form id="document-edit-form">
                                            <input type="hidden" id="edit-document-id">

                                            <div class="mb-3">
                                                <label class="form-label">Title</label>
                                                <input type="text" class="form-control" id="edit-title"
                                                    placeholder="Document title">
                                            </div>

                                            <div class="mb-3">
                                                <label class="form-label">Summary</label>
                                                <textarea class="form-control" id="edit-summary" rows="3"
                                                    placeholder="Document summary"></textarea>
                                            </div>

                                            <div class="mb-3">
                                                <label class="form-label">Correspondent</label>
                                                <select class="form-control" id="edit-correspondent">
                                                    <option value="">Select correspondent...</option>
                                                </select>
                                            </div>

                                            <div class="mb-3">
                                                <label class="form-label">Document Type</label>
                                                <select class="form-control" id="edit-doctype">
                                                    <option value="">Select document type...</option>
                                                </select>
                                            </div>

                                            <div class="mb-3">
                                                <label class="form-label">Document Date</label>
                                                <input type="date" class="form-control" id="edit-document-date">
                                            </div>

                                            <div class="mb-3">
                                                <label class="form-label" for="edit-reminder-date">Reminder Date</label>
                                                <input type="date" class="form-control" id="edit-reminder-date">
                                            </div>

                                            <div class="mb-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox"
                                                        id="edit-tax-relevant">
                                                    <label class="form-check-label" for="edit-tax-relevant">
                                                        Tax Relevant
                                                    </label>
                                                </div>
                                            </div>

                                            <div class="mb-3">
                                                <label class="form-label">
                                                    <i class="fas fa-tags me-2"></i>Tags
                                                </label>
                                                <div id="edit-tags-container">
                                                    <!-- Tags will be populated here -->
                                                </div>
                                                <div class="tag-input-group position-relative">
                                                    <input type="text" class="form-control" id="new-tag-input"
                                                        placeholder="Add new tag..."
                                                        onkeypress="handleTagInputKeyPress(event)"
                                                        oninput="filterTagSuggestions()" onfocus="showTagSuggestions()"
                                                        onblur="hideTagSuggestionsDelayed()">
                                                    <div class="tag-suggestions-dropdown d-none"
                                                        id="tag-suggestions-dropdown">
                                                        <div class="tag-suggestions-content">
                                                            <!-- Tag suggestions will be populated here -->
                                                        </div>
                                                    </div>
                                                    <button type="button" class="btn btn-primary"
                                                        onclick="addDocumentTag()">
                                                        <i class="fas fa-plus me-1"></i>Add
                                                    </button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>

                                    <!-- Additional Information Tab -->
                                    <div class="tab-pane" id="additional-panel" role="tabpanel">
                                        <div class="mb-3">
                                            <label class="form-label">
                                                <i class="fas fa-file-alt me-2"></i>File Information
                                            </label>
                                            <div class="card">
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-4 text-muted">Filename:</div>
                                                        <div class="col-8" id="edit-filename"></div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-4 text-muted">Size:</div>
                                                        <div class="col-8" id="edit-file-size"></div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-4 text-muted">Type:</div>
                                                        <div class="col-8" id="edit-mime-type"></div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-4 text-muted">Path:</div>
                                                        <div class="col-8" id="edit-file-path"></div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-4 text-muted">Created:</div>
                                                        <div class="col-8" id="edit-created-at"></div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-4 text-muted">Processed:</div>
                                                        <div class="col-8" id="edit-processed-at"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label">
                                                <i class="fas fa-cogs me-2"></i>Processing Status
                                            </label>
                                            <div class="card">
                                                <div class="card-body">
                                                    <div class="row mb-2">
                                                        <div class="col-4 text-muted">OCR Status:</div>
                                                        <div class="col-8">
                                                            <span id="edit-ocr-status" class="badge"></span>
                                                            <button id="rerun-ocr-btn"
                                                                class="btn btn-sm btn-outline-secondary ms-2"
                                                                style="display: none;" onclick="rerunOCRProcessing()">
                                                                <i class="fas fa-redo me-1"></i>Rerun
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <div class="row mb-2">
                                                        <div class="col-4 text-muted">AI Status:</div>
                                                        <div class="col-8">
                                                            <span id="edit-ai-status" class="badge"></span>
                                                            <button id="rerun-ai-btn"
                                                                class="btn btn-sm btn-outline-primary ms-2"
                                                                style="display: none;" onclick="rerunAIProcessing()">
                                                                <i class="fas fa-redo me-1"></i>Rerun
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-4 text-muted">Vectorization:</div>
                                                        <div class="col-8">
                                                            <span id="edit-vector-status" class="badge"></span>
                                                            <button id="rerun-vector-btn"
                                                                class="btn btn-sm btn-outline-success ms-2"
                                                                style="display: none;"
                                                                onclick="rerunVectorProcessing()">
                                                                <i class="fas fa-redo me-1"></i>Rerun
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label">
                                                <i class="fas fa-chart-line me-2"></i>Document Statistics
                                            </label>
                                            <div class="card">
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-6 text-muted">View Count:</div>
                                                        <div class="col-6" id="edit-view-count">0</div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-6 text-muted">Last Viewed:</div>
                                                        <div class="col-6" id="edit-last-viewed">Never</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Document Approval Section -->
                                        <div class="mb-4">
                                            <label class="form-label text-primary">
                                                <i class="fas fa-check-circle me-2"></i>Approval Status
                                            </label>
                                            <div class="card">
                                                <div class="card-body">
                                                    <div class="row mb-2">
                                                        <div class="col-6 text-muted">Status:</div>
                                                        <div class="col-6" id="edit-approval-status">
                                                            <span class="badge bg-secondary"><i
                                                                    class="fas fa-clock me-1"></i>Pending</span>
                                                        </div>
                                                    </div>
                                                    <div class="row mb-2">
                                                        <div class="col-6 text-muted">Approved At:</div>
                                                        <div class="col-6" id="edit-approved-at">N/A</div>
                                                    </div>
                                                    <div class="row mb-3">
                                                        <div class="col-6 text-muted">Approved By:</div>
                                                        <div class="col-6" id="edit-approved-by">N/A</div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-12">
                                                            <button type="button" class="btn btn-success btn-sm me-2"
                                                                id="approve-document-btn"
                                                                onclick="approveDocumentFromModal()">
                                                                <i class="fas fa-thumbs-up me-1"></i>Approve Document
                                                            </button>
                                                            <button type="button" class="btn btn-outline-warning btn-sm"
                                                                id="disapprove-document-btn"
                                                                onclick="disapproveDocumentFromModal()"
                                                                style="display: none;">
                                                                <i class="fas fa-times me-1"></i>Remove Approval
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Logs Tab -->
                                    <div class="tab-pane" id="logs-panel" role="tabpanel">
                                        <div class="mb-3">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <label class="form-label mb-0">
                                                    <i class="fas fa-list-alt me-2"></i>Processing Logs
                                                </label>
                                                <button type="button" class="btn btn-outline-secondary btn-sm"
                                                    onclick="loadDocumentLogs()">
                                                    <i class="fas fa-refresh me-1"></i>Refresh
                                                </button>
                                            </div>
                                            <div class="card">
                                                <div class="card-body p-2">
                                                    <div id="document-logs" class="small"
                                                        style="max-height: 400px; overflow-y: auto; font-family: monospace;">
                                                        <!-- Document logs will be loaded here -->
                                                        <div class="text-center text-muted p-3">
                                                            <i class="fas fa-info-circle me-2"></i>
                                                            Click refresh to load processing logs
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label">
                                                <i class="fas fa-history me-2"></i>Document History
                                            </label>
                                            <div class="card">
                                                <div class="card-body">
                                                    <div id="document-history" class="small">
                                                        <!-- Document history will be loaded here -->
                                                        <div class="text-muted">No history available</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- OCR Tab -->
                                    <div class="tab-pane" id="ocr-panel" role="tabpanel">
                                        <div class="mb-3">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <label class="form-label mb-0">
                                                    <i class="fas fa-file-text me-2"></i>Extracted Text Content
                                                </label>
                                                <button type="button" class="btn btn-outline-secondary btn-sm"
                                                    onclick="loadOCRContent(currentDocument ? currentDocument.id : null)">
                                                    <i class="fas fa-refresh me-1"></i>Refresh
                                                </button>
                                            </div>
                                            <div class="card">
                                                <div class="card-body p-2">
                                                    <div id="ocr-text-content" class="ocr-content"
                                                        style="max-height: 400px; overflow-y: auto; font-family: monospace; font-size: 0.9em; line-height: 1.4;">
                                                        <!-- OCR content will be loaded here -->
                                                        <div class="text-center text-muted p-3">
                                                            <i class="fas fa-spinner fa-spin me-2"></i>Loading OCR
                                                            content...
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label">
                                                <i class="fas fa-search me-2"></i>Search in Content
                                            </label>
                                            <div class="input-group">
                                                <input type="text" class="form-control" id="ocr-search"
                                                    placeholder="Search in OCR text..." onkeyup="searchInOCR()">
                                                <button class="btn btn-outline-secondary" onclick="clearOCRSearch()">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                            <div class="small text-muted mt-1">
                                                <span id="ocr-search-results"></span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Relations Tab -->
                                    <div class="tab-pane" id="relations-panel" role="tabpanel">
                                        <div id="relationsContent" class="mb-3">
                                            <!-- Relations content will be dynamically loaded here -->
                                        </div>

                                        <!-- Similar Documents Section -->
                                        <div class="mb-3">
                                            <div class="d-flex justify-content-between align-items-center mb-3">
                                                <h6 class="mb-0">
                                                    <i class="fas fa-search me-2"></i>Similar Documents
                                                </h6>
                                                <button type="button" class="btn btn-outline-primary btn-sm"
                                                    onclick="showSimilarDocumentsForCurrent()">
                                                    <i class="fas fa-refresh me-1"></i>Find Similar
                                                </button>
                                            </div>
                                            <div id="similar-documents-list" class="similar-documents-container">
                                                <!-- Similar documents will be displayed here -->
                                                <div class="text-muted text-center p-3">
                                                    <i class="fas fa-info-circle me-2"></i>Click "Find Similar" to
                                                    discover related documents
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Notes Tab -->
                                    <div class="tab-pane" id="notes-panel" role="tabpanel">
                                        <div class="mb-3">
                                            <div class="d-flex justify-content-between align-items-center mb-3">
                                                <h6 class="mb-0">
                                                    <i class="fas fa-sticky-note me-2"></i>Document Notes
                                                </h6>
                                                <div>
                                                    <small class="text-muted">Auto-saves while typing</small>
                                                </div>
                                            </div>

                                            <div class="notes-editor-container">
                                                <textarea id="document-notes" class="form-control notes-textarea"
                                                    placeholder="Add your notes about this document here...&#10;&#10;You can write any additional information, thoughts, or reminders about this document."
                                                    rows="15" oninput="handleNotesChange()"></textarea>

                                                <div class="notes-toolbar mt-2">
                                                    <div class="d-flex justify-content-between align-items-center">
                                                        <div class="notes-info">
                                                            <small class="text-muted">
                                                                <span id="notes-char-count">0</span> characters
                                                                <span id="notes-save-status" class="ms-2"></span>
                                                            </small>
                                                        </div>
                                                        <div class="notes-actions">
                                                            <button type="button"
                                                                class="btn btn-sm btn-outline-secondary me-2"
                                                                onclick="clearNotes()">
                                                                <i class="fas fa-eraser me-1"></i>Clear
                                                            </button>
                                                            <button type="button" class="btn btn-sm btn-primary"
                                                                onclick="saveNotesManually()">
                                                                <i class="fas fa-save me-1"></i>Save
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Action Buttons -->
                                <div class="d-flex gap-2 pt-3 mt-auto border-top">
                                    <button type="button" class="btn btn-secondary flex-fill" data-bs-dismiss="modal">
                                        <i class="fas fa-times me-1"></i>Close
                                    </button>
                                    <button type="button" class="btn btn-danger" onclick="deleteDocument()">
                                        <i class="fas fa-trash me-1"></i>Delete
                                    </button>
                                    <button type="button" class="btn btn-primary" onclick="saveDocumentChanges()">
                                        <i class="fas fa-save me-1"></i>Save
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Correspondent Edit Modal -->
    <div class="modal fade" id="correspondentModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-user-edit me-2 text-primary"></i>
                        <span id="correspondent-modal-title">Edit Correspondent</span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="correspondent-form">
                        <div class="mb-3">
                            <label class="form-label" for="correspondent-name">Name *</label>
                            <input type="text" class="form-control" id="correspondent-name"
                                placeholder="Enter correspondent name..." required>
                            <div class="form-text">
                                The name of the person or organization
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label" for="correspondent-email">Email</label>
                            <input type="email" class="form-control" id="correspondent-email"
                                placeholder="email@example.com">
                            <div class="form-text">
                                Contact email address (optional)
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label" for="correspondent-address">Address</label>
                            <textarea class="form-control" id="correspondent-address" rows="3"
                                placeholder="Enter address..."></textarea>
                            <div class="form-text">
                                Physical or postal address (optional)
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i>Cancel
                    </button>
                    <button type="button" class="btn btn-primary" id="correspondent-save-btn">
                        <i class="fas fa-save me-1"></i>Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Relation Modal -->
    <div class="modal fade" id="addRelationModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-link me-2 text-primary"></i>Add Document Relation
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Search Documents</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="document-search"
                                placeholder="Type to search documents..." onkeyup="searchDocumentsForRelation()"
                                onfocus="searchDocumentsForRelation()">
                            <div class="input-group-text">
                                <div class="form-check form-switch mb-0">
                                    <input type="checkbox" class="form-check-input" id="relation-search-semantic"
                                        checked>
                                    <label class="form-check-label" for="relation-search-semantic">
                                        <i class="fas fa-brain me-1"></i>AI
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="form-text">
                            Search by title, filename, or correspondent name. Toggle AI for semantic search.
                        </div>
                    </div>

                    <div id="document-search-results" class="document-list"
                        style="max-height: 300px; overflow-y: auto;">
                        <!-- Search results will be displayed here -->
                        <div class="text-muted text-center p-3">
                            Start typing to search for documents...
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i>Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Rename Modal -->
    <div class="modal fade" id="renameModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-edit me-2 text-primary"></i>
                        <span id="rename-modal-title">Rename Item</span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="rename-form">
                        <div class="mb-3">
                            <label class="form-label" id="rename-field-label">New Name</label>
                            <input type="text" class="form-control" id="rename-input" placeholder="Enter new name..."
                                required>
                            <div class="form-text" id="rename-help-text">
                                Enter a new name for this item
                            </div>
                        </div>
                        <div class="rename-preview d-none">
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>
                                <strong>Preview:</strong> <span id="rename-preview-text"></span>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i>Cancel
                    </button>
                    <button type="button" class="btn btn-primary" id="rename-confirm-btn">
                        <i class="fas fa-save me-1"></i>Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Setup Wizard Modal -->
    <div class="modal fade" id="setupWizardModal" tabindex="-1" aria-labelledby="setupWizardModalLabel"
        aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="setupWizardModalLabel">
                        <i class="fas fa-magic me-2 text-primary"></i>Setup Wizard
                    </h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Step Progress Indicator -->
                    <div class="d-flex justify-content-between mb-4">
                        <div class="progress flex-grow-1">
                            <div id="setup-progress" class="progress-bar bg-primary" role="progressbar"
                                style="width: 25%"></div>
                        </div>
                        <span class="ms-3 small text-muted" id="setup-step-indicator">Step 1 of 6</span>
                    </div>

                    <!-- Step 1: Welcome -->
                    <div id="setup-step-1" class="setup-step">
                        <div class="text-center mb-4">
                            <i class="fas fa-rocket fa-3x text-primary mb-3"></i>
                            <h3>Welcome to DocuManager!</h3>
                            <p class="lead">Let's get your document management system set up and ready to use.</p>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="card h-100">
                                    <div class="card-body text-center">
                                        <i class="fas fa-brain fa-2x text-primary mb-2"></i>
                                        <h6>AI-Powered</h6>
                                        <p class="small">Automatic document analysis and smart search</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="card h-100">
                                    <div class="card-body text-center">
                                        <i class="fas fa-folder-tree fa-2x text-success mb-2"></i>
                                        <h6>Auto-Organization</h6>
                                        <p class="small">Documents organized by correspondent and date</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            This wizard will help you configure the essential settings to get started quickly.
                        </div>
                        <div class="mt-4 text-center">
                            <small class="text-muted">
                                Created with ❤️ by <a href="mailto:hi@visqo.com" class="text-decoration-none">Jannik Reinhard and Fabian Peschke</a>
                            </small>
                            <div class="mt-2">
                                <a href="https://www.buymeacoffee.com/jannikreinf" target="_blank">
                                    <img src="https://www.buymeacoffee.com/assets/img/custom_images/orange_img.png"
                                        alt="Buy Me A Coffee"
                                        style="height: 41px !important;width: 174px !important;box-shadow: 0px 3px 2px 0px rgba(190, 190, 190, 0.5) !important">
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: User Management -->
                    <div id="setup-step-2" class="setup-step d-none">
                        <h4><i class="fas fa-user-shield me-2"></i>Admin User Setup</h4>
                        <p class="mb-4">Create your administrator account to secure and manage the system.</p>

                        <div class="alert alert-warning mb-4">
                            <i class="fas fa-shield-alt me-2"></i>
                            <strong>Security Notice:</strong> This account will have full administrative access to your
                            document management system.
                        </div>

                        <form id="admin-setup-form">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="wizard-admin-username" class="form-label">Username <span
                                                class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="wizard-admin-username"
                                            placeholder="admin" required>
                                        <div class="form-text">Choose a unique username for the administrator</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="wizard-admin-email" class="form-label">Email Address <span
                                                class="text-danger">*</span></label>
                                        <input type="email" class="form-control" id="wizard-admin-email"
                                            placeholder="admin@company.com" required>
                                        <div class="form-text">Email for notifications and password recovery</div>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="wizard-admin-fullname" class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="wizard-admin-fullname"
                                    placeholder="System Administrator">
                                <div class="form-text">Optional: Display name for the administrator</div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="wizard-admin-password" class="form-label">Password <span
                                                class="text-danger">*</span></label>
                                        <input type="password" class="form-control" id="wizard-admin-password"
                                            placeholder="Enter a secure password" required minlength="8"
                                            autocomplete="new-password">
                                        <div class="form-text">Minimum 8 characters, include numbers and special
                                            characters</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="wizard-admin-confirm-password" class="form-label">Confirm Password
                                            <span class="text-danger">*</span></label>
                                        <input type="password" class="form-control" id="wizard-admin-confirm-password"
                                            placeholder="Confirm your password" required autocomplete="new-password">
                                        <div class="form-text">Re-enter the password to confirm</div>
                                    </div>
                                </div>
                            </div>
                        </form>

                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Note:</strong> You can create additional users and configure roles after completing
                            the setup.
                        </div>
                    </div>

                    <!-- Step 3: AI Provider Configuration -->
                    <div id="setup-step-3" class="setup-step d-none">
                        <h4><i class="fas fa-key me-2"></i>AI Provider Configuration</h4>
                        <p class="mb-4">Configure AI services for document analysis and smart search capabilities.</p>

                        <!-- AI Provider Selection -->
                        <div class="mb-4">
                            <label class="form-label">Select AI Provider <span class="text-danger">*</span></label>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="wizard-ai-provider"
                                            id="wizard-provider-openai" value="openai" checked>
                                        <label class="form-check-label" for="wizard-provider-openai">
                                            <strong>OpenAI</strong>
                                            <div class="text-muted small">Direct OpenAI API access</div>
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="wizard-ai-provider"
                                            id="wizard-provider-azure" value="azure">
                                        <label class="form-check-label" for="wizard-provider-azure">
                                            <strong>Azure OpenAI</strong>
                                            <div class="text-muted small">Microsoft Azure hosted models</div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- OpenAI Configuration -->
                        <div id="wizard-openai-config">
                            <form id="openai-config-form">
                                <div class="mb-3">
                                    <label for="wizard-openai-api-key" class="form-label">OpenAI API Key <span
                                            class="text-danger">*</span></label>
                                    <input type="password" class="form-control" id="wizard-openai-api-key"
                                        placeholder="sk-..." onfocus="handleApiKeyFieldFocus()"
                                        onblur="handleApiKeyFieldBlur()" autocomplete="new-password">
                                    <div class="form-text">
                                        Get your API key from <a href="https://platform.openai.com/api-keys"
                                            target="_blank">OpenAI Platform</a>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="wizard-embedding-model" class="form-label">Embedding Model</label>
                                    <select class="form-select" id="wizard-embedding-model">
                                        <option value="text-embedding-ada-002">text-embedding-ada-002 ($0.10/1M tokens)
                                        </option>
                                        <option value="text-embedding-3-small">text-embedding-3-small ($0.02/1M tokens)
                                            - Recommended</option>
                                        <option value="text-embedding-3-large">text-embedding-3-large ($0.13/1M tokens)
                                        </option>
                                    </select>
                                    <div class="form-text">Model for semantic search and document similarity</div>
                                </div>
                            </form>

                            <!-- Model Selection (OpenAI only) -->
                            <div id="wizard-model-selection">
                                <div class="mb-3">
                                    <label for="wizard-analysis-model" class="form-label">Document Analysis
                                        Model</label>
                                    <select class="form-select" id="wizard-analysis-model">
                                        <option value="gpt-4o-mini">GPT-4o Mini ($0.15/$0.60 per 1M) - Recommended
                                        </option>
                                        <option value="gpt-4o-mini-2024-07-18">GPT-4o Mini 2024-07-18 ($0.15/$0.60 per
                                            1M) - Structured Output</option>
                                        <option value="gpt-4o">GPT-4o ($5.00/$15.00 per 1M)</option>
                                        <option value="gpt-4o-2024-08-06">GPT-4o 2024-08-06 ($2.50/$10.00 per 1M) -
                                            Structured Output</option>
                                        <option value="gpt-4o-2024-11-20">GPT-4o 2024-11-20 ($2.50/$10.00 per 1M) -
                                            Latest</option>
                                        <option value="gpt-4-turbo">GPT-4 Turbo ($10.00/$30.00 per 1M)</option>
                                        <option value="gpt-4-turbo-2024-04-09">GPT-4 Turbo 2024-04-09 ($10.00/$30.00 per
                                            1M)</option>
                                        <option value="gpt-4">GPT-4 ($30.00/$60.00 per 1M)</option>
                                        <option value="gpt-4-0613">GPT-4 0613 ($30.00/$60.00 per 1M)</option>
                                        <option value="gpt-3.5-turbo">GPT-3.5 Turbo ($0.50/$1.50 per 1M)</option>
                                        <option value="gpt-3.5-turbo-0125">GPT-3.5 Turbo 0125 ($0.50/$1.50 per 1M)
                                        </option>
                                    </select>
                                    <div class="form-text">Model for extracting metadata and classifying documents</div>
                                </div>

                                <div class="mb-3">
                                    <label for="wizard-chat-model" class="form-label">Chat/RAG Model</label>
                                    <select class="form-select" id="wizard-chat-model">
                                        <option value="gpt-4o-mini">GPT-4o Mini ($0.15/$0.60 per 1M) - Recommended
                                        </option>
                                        <option value="gpt-4o-mini-2024-07-18">GPT-4o Mini 2024-07-18 ($0.15/$0.60 per
                                            1M) - Structured Output</option>
                                        <option value="gpt-4o">GPT-4o ($5.00/$15.00 per 1M)</option>
                                        <option value="gpt-4o-2024-08-06">GPT-4o 2024-08-06 ($2.50/$10.00 per 1M) -
                                            Structured Output</option>
                                        <option value="gpt-4o-2024-11-20">GPT-4o 2024-11-20 ($2.50/$10.00 per 1M) -
                                            Latest</option>
                                        <option value="gpt-4-turbo">GPT-4 Turbo ($10.00/$30.00 per 1M)</option>
                                        <option value="gpt-4-turbo-2024-04-09">GPT-4 Turbo 2024-04-09 ($10.00/$30.00 per
                                            1M)</option>
                                        <option value="gpt-4">GPT-4 ($30.00/$60.00 per 1M)</option>
                                        <option value="gpt-4-0613">GPT-4 0613 ($30.00/$60.00 per 1M)</option>
                                        <option value="gpt-3.5-turbo">GPT-3.5 Turbo ($0.50/$1.50 per 1M)</option>
                                        <option value="gpt-3.5-turbo-0125">GPT-3.5 Turbo 0125 ($0.50/$1.50 per 1M)
                                        </option>
                                        <option value="o1-mini">o1-mini ($3.00/$12.00 per 1M) - Reasoning</option>
                                        <option value="o1-mini-2024-09-12">o1-mini 2024-09-12 ($3.00/$12.00 per 1M)
                                        </option>
                                        <option value="o1-preview">o1-preview ($15.00/$60.00 per 1M) - Advanced
                                            Reasoning</option>
                                        <option value="o1-preview-2024-09-12">o1-preview 2024-09-12 ($15.00/$60.00 per
                                            1M)</option>
                                    </select>
                                    <div class="form-text">Model for answering questions about your documents</div>
                                </div>
                            </div>
                        </div>

                        <!-- Azure OpenAI Configuration -->
                        <div id="wizard-azure-config" class="d-none">
                            <div class="alert alert-info mb-3">
                                <i class="fas fa-info-circle me-2"></i>
                                Azure OpenAI uses deployment names instead of model names. Create deployments in your
                                Azure portal.
                            </div>
                            <form id="azure-config-form">
                                <div class="mb-3">
                                    <label for="wizard-azure-api-key" class="form-label">Azure OpenAI API Key <span
                                            class="text-danger">*</span></label>
                                    <input type="password" class="form-control" id="wizard-azure-api-key"
                                        placeholder="Enter your Azure OpenAI API key" autocomplete="new-password">
                                </div>
                                <div class="mb-3">
                                    <label for="wizard-azure-endpoint" class="form-label">Endpoint URL <span
                                            class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="wizard-azure-endpoint"
                                        placeholder="https://your-resource.openai.azure.com/">
                                    <div class="form-text">Your Azure OpenAI resource endpoint</div>
                                </div>
                                <div class="mb-3">
                                    <label for="wizard-azure-chat-deployment" class="form-label">Chat Model Deployment
                                        <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="wizard-azure-chat-deployment"
                                        placeholder="e.g., gpt-4o-deployment">
                                    <div class="form-text">Deployment name for chat and analysis</div>
                                </div>
                                <div class="mb-3">
                                    <label for="wizard-azure-embeddings-deployment" class="form-label">Embeddings
                                        Deployment <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="wizard-azure-embeddings-deployment"
                                        placeholder="e.g., embeddings-deployment">
                                    <div class="form-text">Deployment name for embeddings</div>
                                </div>
                            </form>
                        </div>

                        <div class="alert alert-warning" id="wizard-ai-note">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>Note:</strong> <span id="wizard-ai-note-text">The OpenAI API key is required for
                                document analysis and AI features.</span>
                        </div>
                    </div>

                    <!-- Step 4: Folder Configuration -->
                    <div id="setup-step-4" class="setup-step d-none">
                        <h4><i class="fas fa-folder-tree me-2"></i>Folder Structure</h4>
                        <p class="mb-4">Configure where your documents will be stored and organized.</p>

                        <div class="mb-3">
                            <label for="wizard-root-folder" class="form-label">Root Directory</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="wizard-root-folder"
                                    placeholder="/path/to/document/management" readonly>
                                <button class="btn btn-outline-secondary" type="button"
                                    onclick="selectWizardRootFolder()">
                                    <i class="fas fa-folder-open"></i>
                                </button>
                            </div>
                            <div class="form-text">Base directory for the document management system</div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="wizard-staging-folder" class="form-label">Staging Folder</label>
                                    <input type="text" class="form-control" id="wizard-staging-folder" value="data/staging"
                                        placeholder="data/staging">
                                    <div class="form-text">New documents to be processed</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="wizard-storage-folder" class="form-label">Storage Folder</label>
                                    <input type="text" class="form-control" id="wizard-storage-folder" value="data/storage"
                                        placeholder="data/storage">
                                    <div class="form-text">Organized, processed documents</div>
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            These folders will be created automatically if they don't exist.
                        </div>
                    </div>

                    <!-- Step 5: Review Configuration -->
                    <div id="setup-step-5" class="setup-step d-none">
                        <h4><i class="fas fa-check-double me-2"></i>Review Configuration</h4>
                        <p class="mb-4">Please review your configuration before completing the setup.</p>

                        <div class="card mb-3">
                            <div class="card-body">
                                <h6 class="card-title">Administrator Account</h6>
                                <dl class="row mb-0" id="review-admin-config">
                                    <!-- Dynamic content will be inserted here -->
                                </dl>
                            </div>
                        </div>

                        <div class="card mb-3">
                            <div class="card-body">
                                <h6 class="card-title">AI Configuration</h6>
                                <dl class="row mb-0" id="review-ai-config">
                                    <!-- Dynamic content will be inserted here -->
                                </dl>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-body">
                                <h6 class="card-title">Folder Configuration</h6>
                                <dl class="row mb-0">
                                    <dt class="col-sm-4">Root Directory:</dt>
                                    <dd class="col-sm-8" id="review-root-folder">Default location</dd>
                                </dl>
                            </div>
                        </div>
                    </div>

                    <!-- Step 6: Completion -->
                    <div id="setup-step-6" class="setup-step d-none">
                        <div class="text-center mb-4">
                            <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                            <h3>Setup Complete!</h3>
                            <p class="lead">Your document management system is ready to use.</p>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <i class="fas fa-upload fa-2x text-primary mb-2"></i>
                                        <h6>Upload Documents</h6>
                                        <p class="small">Start by uploading your first documents</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <i class="fas fa-cogs fa-2x text-warning mb-2"></i>
                                        <h6>Fine-tune Settings</h6>
                                        <p class="small">Adjust configuration in the Settings tab</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <i class="fas fa-question-circle fa-2x text-info mb-2"></i>
                                        <h6>Need Help?</h6>
                                        <p class="small">Use the Setup Assistant for guidance</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="wizard-prev-btn"
                        onclick="event.stopPropagation(); previousWizardStep()" disabled>
                        <i class="fas fa-arrow-left me-1"></i>Previous
                    </button>
                    <button type="button" class="btn btn-primary" id="wizard-next-btn"
                        onclick="event.stopPropagation(); nextWizardStep()">
                        Next<i class="fas fa-arrow-right ms-1"></i>
                    </button>
                    <button type="button" class="btn btn-success d-none" id="wizard-finish-btn"
                        onclick="event.stopPropagation(); finishSetupWizard()">
                        <i class="fas fa-check me-1"></i>Finish Setup
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Setup Assistant Modal -->
    <div class="modal fade" id="setupAssistantModal" tabindex="-1" aria-labelledby="setupAssistantModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="setupAssistantModalLabel">
                        <i class="fas fa-question-circle me-2 text-primary"></i>Setup Assistant
                    </h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="list-group" id="assistant-menu">
                                <button type="button" class="list-group-item list-group-item-action active"
                                    onclick="showAssistantSection('getting-started')">
                                    <i class="fas fa-rocket me-2"></i>Getting Started
                                </button>
                                <button type="button" class="list-group-item list-group-item-action"
                                    onclick="showAssistantSection('ai-setup')">
                                    <i class="fas fa-brain me-2"></i>AI Configuration
                                </button>
                                <button type="button" class="list-group-item list-group-item-action"
                                    onclick="showAssistantSection('file-management')">
                                    <i class="fas fa-folder me-2"></i>File Management
                                </button>
                                <button type="button" class="list-group-item list-group-item-action"
                                    onclick="showAssistantSection('troubleshooting')">
                                    <i class="fas fa-wrench me-2"></i>Troubleshooting
                                </button>
                                <button type="button" class="list-group-item list-group-item-action"
                                    onclick="showAssistantSection('backup-restore')">
                                    <i class="fas fa-download me-2"></i>Backup & Restore
                                </button>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <!-- Getting Started Section -->
                            <div id="assistant-getting-started" class="assistant-section">
                                <h5><i class="fas fa-rocket me-2"></i>Getting Started</h5>
                                <div class="mb-4">
                                    <h6>Quick Start Guide</h6>
                                    <ol>
                                        <li><strong>Initial Setup:</strong> Run the Setup Wizard or configure admin user
                                            in Settings → Security</li>
                                        <li><strong>Configure AI Provider:</strong> Go to Settings → AI Configuration
                                            and add your API key (OpenAI or Azure)</li>
                                        <li><strong>Upload Documents:</strong> Use the Upload tab to add PDF, image, or
                                            other document files</li>
                                        <li><strong>Wait for Processing:</strong> Documents are automatically processed
                                            with OCR and AI analysis</li>
                                        <li><strong>Browse & Search:</strong> Use the Documents tab to browse or the
                                            Search tab for advanced queries</li>
                                        <li><strong>Ask AI Questions:</strong> Use the Ask AI tab to query your
                                            documents intelligently</li>
                                    </ol>
                                </div>
                                <div class="alert alert-info">
                                    <i class="fas fa-lightbulb me-2"></i>
                                    <strong>Tip:</strong> Start with the Setup Wizard for a guided configuration
                                    experience.
                                </div>
                            </div>

                            <!-- AI Setup Section -->
                            <div id="assistant-ai-setup" class="assistant-section d-none">
                                <h5><i class="fas fa-brain me-2"></i>AI Configuration</h5>
                                <div class="mb-4">
                                    <h6>AI Provider Setup</h6>
                                    <p>The system supports multiple AI providers:</p>
                                    <h6 class="mt-3">OpenAI</h6>
                                    <ol>
                                        <li>Visit <a href="https://platform.openai.com/api-keys" target="_blank">OpenAI
                                                Platform</a></li>
                                        <li>Create an account or sign in</li>
                                        <li>Generate a new API key</li>
                                        <li>Copy the key and paste it in Settings → AI Configuration</li>
                                    </ol>
                                    <h6 class="mt-3">Azure OpenAI</h6>
                                    <ol>
                                        <li>Set up Azure OpenAI service in your Azure portal</li>
                                        <li>Deploy the required models (embeddings, extraction, chat)</li>
                                        <li>Copy your endpoint URL and API key</li>
                                        <li>Configure in Settings → AI Configuration with Azure provider</li>
                                    </ol>
                                </div>
                                <div class="mb-4">
                                    <h6>AI Models & Limits</h6>
                                    <p><strong>Embedding Models:</strong></p>
                                    <ul>
                                        <li><code>text-embedding-ada-002</code> - Most cost-effective (recommended)</li>
                                        <li><code>text-embedding-3-small</code> - Higher quality, moderate cost</li>
                                        <li><code>text-embedding-3-large</code> - Highest quality, higher cost</li>
                                    </ul>
                                    <p><strong>Extraction Models:</strong></p>
                                    <ul>
                                        <li><code>gpt-4o-mini</code> - Fast and cost-effective (recommended)</li>
                                        <li><code>gpt-4o</code> - Best quality for complex documents</li>
                                        <li><code>gpt-3.5-turbo</code> - Budget option</li>
                                    </ul>
                                    <p><strong>Chat/RAG Models:</strong></p>
                                    <ul>
                                        <li><code>gpt-4o-mini</code> - Fast responses (recommended)</li>
                                        <li><code>gpt-4o</code> - Advanced reasoning</li>
                                        <li><code>o1-mini</code> - Complex reasoning tasks</li>
                                        <li><code>o1-preview</code> - Most advanced reasoning</li>
                                    </ul>
                                    <p><strong>Processing Limits:</strong></p>
                                    <ul>
                                        <li><strong>Text Limit:</strong> Max characters analyzed per document (16,000
                                            recommended)</li>
                                        <li><strong>Context Limit:</strong> Max context for AI questions (10,000
                                            recommended)</li>
                                    </ul>
                                </div>
                            </div>

                            <!-- File Management Section -->
                            <div id="assistant-file-management" class="assistant-section d-none">
                                <h5><i class="fas fa-folder me-2"></i>File Management</h5>
                                <div class="mb-4">
                                    <h6>Folder Structure</h6>
                                    <p>The system uses the following folder structure:</p>
                                    <ul>
                                        <li><strong>staging/</strong> - Drop new files here for processing</li>
                                        <li><strong>storage/</strong> - Organized files by correspondent/date</li>
                                        <li><strong>data/</strong> - Database and system data</li>
                                        <li><strong>logs/</strong> - Application logs</li>
                                    </ul>
                                </div>
                                <div class="mb-4">
                                    <h6>Supported File Types</h6>
                                    <ul>
                                        <li><strong>PDF:</strong> .pdf files (most common)</li>
                                        <li><strong>Images:</strong> .png, .jpg, .jpeg, .tiff, .bmp</li>
                                        <li><strong>Size Limit:</strong> Default 52MB per file</li>
                                        <li><strong>Processing:</strong> OCR extracts text, AI analyzes content</li>
                                        <li><strong>Organization:</strong> Files stored as
                                            {correspondent}/{date}/{filename}</li>
                                    </ul>
                                </div>
                                <div class="alert alert-warning">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    <strong>Note:</strong> Files are automatically organized once processed. Original
                                    files in staging are kept as backup.
                                </div>
                            </div>

                            <!-- Troubleshooting Section -->
                            <div id="assistant-troubleshooting" class="assistant-section d-none">
                                <h5><i class="fas fa-wrench me-2"></i>Troubleshooting</h5>
                                <div class="mb-4">
                                    <h6>Common Issues</h6>
                                    <div class="accordion" id="troubleshootingAccordion">
                                        <div class="accordion-item">
                                            <h2 class="accordion-header">
                                                <button class="accordion-button collapsed" type="button"
                                                    data-bs-toggle="collapse" data-bs-target="#trouble0">
                                                    Login/Authentication Issues
                                                </button>
                                            </h2>
                                            <div id="trouble0" class="accordion-collapse collapse">
                                                <div class="accordion-body">
                                                    <ul>
                                                        <li>Ensure you have created an admin user (Settings → Security)
                                                        </li>
                                                        <li>Check if cookies are enabled in your browser</li>
                                                        <li>Try clearing browser cache and cookies</li>
                                                        <li>Verify the backend server is running (./start.sh)</li>
                                                        <li>Check logs for authentication errors</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="accordion-item">
                                            <h2 class="accordion-header">
                                                <button class="accordion-button collapsed" type="button"
                                                    data-bs-toggle="collapse" data-bs-target="#trouble1">
                                                    AI Features Not Working
                                                </button>
                                            </h2>
                                            <div id="trouble1" class="accordion-collapse collapse">
                                                <div class="accordion-body">
                                                    <ul>
                                                        <li>Check if AI provider (OpenAI/Azure) is configured correctly
                                                        </li>
                                                        <li>Verify API key has sufficient credits/quota</li>
                                                        <li>Test AI connection in Settings → AI Configuration</li>
                                                        <li>For Azure: Ensure all model deployments are specified</li>
                                                        <li>Check system health in Settings → System</li>
                                                        <li>Review logs for specific error messages</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="accordion-item">
                                            <h2 class="accordion-header">
                                                <button class="accordion-button collapsed" type="button"
                                                    data-bs-toggle="collapse" data-bs-target="#trouble2">
                                                    OCR Not Processing Documents
                                                </button>
                                            </h2>
                                            <div id="trouble2" class="accordion-collapse collapse">
                                                <div class="accordion-body">
                                                    <ul>
                                                        <li>Ensure Tesseract OCR is installed</li>
                                                        <li>Check Tesseract path in Settings → OCR</li>
                                                        <li>Verify Poppler tools for PDF processing</li>
                                                        <li>Test OCR functionality in settings</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="accordion-item">
                                            <h2 class="accordion-header">
                                                <button class="accordion-button collapsed" type="button"
                                                    data-bs-toggle="collapse" data-bs-target="#trouble3">
                                                    Search Not Finding Documents
                                                </button>
                                            </h2>
                                            <div id="trouble3" class="accordion-collapse collapse">
                                                <div class="accordion-body">
                                                    <ul>
                                                        <li>Check if documents have been processed (AI status)</li>
                                                        <li>Verify vector database is healthy</li>
                                                        <li>Try rebuilding embeddings in Settings → Database</li>
                                                        <li>For German documents: Search works with both German and
                                                            English terms</li>
                                                        <li>Vector search supports cross-language queries (e.g.,
                                                            "translator" finds "Übersetzung")</li>
                                                        <li>Use the manual document selection in Ask AI tab for specific
                                                            documents</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="accordion-item">
                                            <h2 class="accordion-header">
                                                <button class="accordion-button collapsed" type="button"
                                                    data-bs-toggle="collapse" data-bs-target="#trouble4">
                                                    Document Processing Stuck
                                                </button>
                                            </h2>
                                            <div id="trouble4" class="accordion-collapse collapse">
                                                <div class="accordion-body">
                                                    <ul>
                                                        <li>Check processing status in the Documents tab</li>
                                                        <li>Review processing logs in Settings → System</li>
                                                        <li>Verify OCR and AI services are configured</li>
                                                        <li>Try reprocessing failed documents</li>
                                                        <li>Check disk space and permissions</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="accordion-item">
                                            <h2 class="accordion-header">
                                                <button class="accordion-button collapsed" type="button"
                                                    data-bs-toggle="collapse" data-bs-target="#trouble5">
                                                    Performance Issues
                                                </button>
                                            </h2>
                                            <div id="trouble5" class="accordion-collapse collapse">
                                                <div class="accordion-body">
                                                    <ul>
                                                        <li>Check system health metrics in Settings → System</li>
                                                        <li>Consider using faster AI models (gpt-4o-mini)</li>
                                                        <li>Limit concurrent document processing</li>
                                                        <li>Optimize database in Settings → Database</li>
                                                        <li>Review and clean up old processing logs</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Backup & Restore Section -->
                            <div id="assistant-backup-restore" class="assistant-section d-none">
                                <h5><i class="fas fa-download me-2"></i>Backup & Restore</h5>
                                <div class="mb-4">
                                    <h6>Export Configuration</h6>
                                    <p>The export function creates a ZIP file containing:</p>
                                    <ul>
                                        <li><strong>Settings:</strong> Configuration and environment variables</li>
                                        <li><strong>Database:</strong> Document metadata and relationships</li>
                                        <li><strong>Storage:</strong> Organized document files</li>
                                        <li><strong>Vectors:</strong> AI embeddings for search</li>
                                    </ul>
                                    <p>Regular backups are recommended. You can also set up automatic backups in
                                        Settings → System.</p>
                                </div>
                                <div class="mb-4">
                                    <h6>Import Configuration</h6>
                                    <p>To restore from a backup:</p>
                                    <ol>
                                        <li>Click Import in Settings header</li>
                                        <li>Select your backup ZIP file</li>
                                        <li>Choose what to restore (selective restore available)</li>
                                        <li>Restart the application after import</li>
                                    </ol>
                                </div>
                                <div class="alert alert-warning">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    <strong>Warning:</strong> Importing will overwrite existing data. Always backup
                                    current state first.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i>Close
                    </button>
                    <button type="button" class="btn btn-primary" onclick="showSetupWizard()">
                        <i class="fas fa-magic me-1"></i>Run Setup Wizard
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Settings Modal -->
    <div class="modal fade" id="importSettingsModal" tabindex="-1" aria-labelledby="importSettingsModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="importSettingsModalLabel">
                        <i class="fas fa-upload me-2 text-warning"></i>Import Configuration
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="import-file" class="form-label">Select Backup File</label>
                        <input type="file" class="form-control" id="import-file" accept=".zip">
                        <div class="form-text">Choose a ZIP file exported from DocuManager</div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">What to Restore</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="restore-settings" checked>
                            <label class="form-check-label" for="restore-settings">
                                <i class="fas fa-cog me-1"></i>Settings & Configuration
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="restore-database" checked>
                            <label class="form-check-label" for="restore-database">
                                <i class="fas fa-database me-1"></i>Database & Metadata
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="restore-documents" checked>
                            <label class="form-check-label" for="restore-documents">
                                <i class="fas fa-file-alt me-1"></i>Document Files
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="restore-vectors" checked>
                            <label class="form-check-label" for="restore-vectors">
                                <i class="fas fa-vector-square me-1"></i>Vector Embeddings
                            </label>
                        </div>
                    </div>

                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Warning:</strong> This will overwrite existing data. Consider creating a backup first.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i>Cancel
                    </button>
                    <button type="button" class="btn btn-warning" onclick="performImport()">
                        <i class="fas fa-upload me-1"></i>Import Configuration
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div class="modal fade" id="addUserModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-user-plus me-2 text-primary"></i>Add New User
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="add-user-form">
                        <div class="mb-3">
                            <label for="add-user-username" class="form-label">Username <span
                                    class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="add-user-username" required
                                autocomplete="username">
                        </div>
                        <div class="mb-3">
                            <label for="add-user-email" class="form-label">Email <span
                                    class="text-danger">*</span></label>
                            <input type="email" class="form-control" id="add-user-email" required>
                        </div>
                        <div class="mb-3">
                            <label for="add-user-fullname" class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="add-user-fullname">
                        </div>
                        <div class="mb-3">
                            <label for="add-user-password" class="form-label">Password <span
                                    class="text-danger">*</span></label>
                            <input type="password" class="form-control" id="add-user-password" required minlength="8"
                                autocomplete="new-password">
                            <div class="form-text">Minimum 8 characters</div>
                        </div>
                        <div class="mb-3">
                            <label for="add-user-role" class="form-label">Role</label>
                            <select class="form-select" id="add-user-role">
                                <option value="viewer">Viewer</option>
                                <option value="editor" selected>Editor</option>
                                <option value="admin">Administrator</option>
                            </select>
                        </div>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="add-user-active" checked>
                            <label class="form-check-label" for="add-user-active">
                                Active Account
                            </label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="createUser()">
                        <i class="fas fa-save me-1"></i>Create User
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div class="modal fade" id="editUserModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-user-edit me-2 text-primary"></i>Edit User
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="edit-user-form">
                        <input type="hidden" id="edit-user-id">
                        <div class="mb-3">
                            <label for="edit-user-username" class="form-label">Username</label>
                            <input type="text" class="form-control" id="edit-user-username" autocomplete="username">
                        </div>
                        <div class="mb-3">
                            <label for="edit-user-email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="edit-user-email">
                        </div>
                        <div class="mb-3">
                            <label for="edit-user-fullname" class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="edit-user-fullname">
                        </div>
                        <div class="mb-3">
                            <label for="edit-user-role" class="form-label">Role</label>
                            <select class="form-select" id="edit-user-role">
                                <option value="viewer">Viewer</option>
                                <option value="editor">Editor</option>
                                <option value="admin">Administrator</option>
                            </select>
                        </div>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="edit-user-active">
                            <label class="form-check-label" for="edit-user-active">
                                Active Account
                            </label>
                        </div>
                        <hr>
                        <h6>Reset Password (optional)</h6>
                        <div class="mb-3">
                            <label for="edit-user-new-password" class="form-label">New Password</label>
                            <input type="password" class="form-control" id="edit-user-new-password" minlength="8"
                                autocomplete="new-password">
                            <div class="form-text">Leave blank to keep current password</div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="updateUser()">
                        <i class="fas fa-save me-1"></i>Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.0/marked.min.js"></script>
    <script>
        // Define showTab immediately to avoid ReferenceError
        window.showTab = function (tabName) {
            console.log('Attempting to show tab:', tabName);
            // If the real showTab is available, use it
            if (window.realShowTab) {
                return window.realShowTab(tabName);
            }
            // Otherwise store the request for later
            window.pendingTabRequest = tabName;
            console.log('App.js not loaded yet, storing request for:', tabName);
        };
    </script>
    <script src="/static/utils.js?v=1"></script>
    <script src="/static/search-dropdowns.js?v=1"></script>
    <script src="/static/app.js?v=32"></script>
    <script src="/static/mobile-functions.js?v=1"></script>
    <script>
        // Global error handler for Bootstrap dataset issues
        window.addEventListener('error', function (e) {
            // Suppress Bootstrap dataset null errors
            if (e.message && e.message.includes("Cannot read properties of null (reading 'dataset')")) {
                e.preventDefault();
                return false;
            }
        });

        // Override console.error for unhandled Bootstrap errors
        const originalConsoleError = console.error;
        console.error = function (...args) {
            const message = args.join(' ');
            if (message.includes("Cannot read properties of null (reading 'dataset')")) {
                // Silent suppress Bootstrap dataset errors
                return;
            }
            originalConsoleError.apply(console, args);
        };
    </script>

    <!-- Password Change Modal (for forced password change) -->
    <div class="modal fade" id="forcePasswordChangeModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title">
                        <i class="fas fa-exclamation-triangle me-2"></i>Password Change Required
                    </h5>
                </div>
                <div class="modal-body">
                    <div class="alert alert-warning">
                        <i class="fas fa-shield-alt me-2"></i>
                        <strong>Security Notice:</strong> You must change your password before continuing.
                    </div>
                    <form id="force-password-change-form">
                        <div class="mb-3">
                            <label for="force-current-password" class="form-label">Current Password</label>
                            <input type="password" class="form-control" id="force-current-password" required autocomplete="current-password">
                            <div class="form-text">Enter your current password (default: admin)</div>
                        </div>
                        <div class="mb-3">
                            <label for="force-new-password" class="form-label">New Password</label>
                            <input type="password" class="form-control" id="force-new-password" required minlength="8" autocomplete="new-password">
                            <div class="form-text">Minimum 8 characters, use a strong password</div>
                        </div>
                        <div class="mb-3">
                            <label for="force-confirm-password" class="form-label">Confirm New Password</label>
                            <input type="password" class="form-control" id="force-confirm-password" required autocomplete="new-password">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="submitForcedPasswordChange()">
                        <i class="fas fa-lock me-1"></i>Change Password
                    </button>
                </div>
            </div>
        </div>
    </div>

</body>

</html>